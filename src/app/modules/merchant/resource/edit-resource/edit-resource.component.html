<div class="flex flex-col max-w-260 md:min-w-160 -m-6">

    <!-- Compose form -->
    <!-- <div class="flex flex-col flex-auto p-1 sm:p-2 max-h-140 ">

  </div> -->
    <div class="flex px-4">
        <!-- Selected resource form -->
        <form class="flex flex-col w-full" [formGroup]="addResourceForm">
            <mat-horizontal-stepper [linear]="true" #horizontalStepper>
                <!-- Basic info section -->
                <mat-step [formGroupName]="'step1'" [stepControl]="addResourceForm.get('step1')"
                    #horizontalStepperStep1>
                    <ng-template matStepLabel>Basic information</ng-template>

                    <!-- Content -->
                    <div class="content flex flex-col overflow-y-auto">

                        <!-- Main -->
                        <div class="flex px-2 flex-col lg:flex-row mb-4 lg:mb-0 w-full">
                            <!-- Resource images and status -->
                            <div class="flex flex-col items-center w-full lg:w-2/12 sm:items-start lg:pb-1">
                                <div class="flex flex-col items-center w-full">
                                    <div class="relative">
                                        <!-- Image Frame -->
                                        <div *ngIf="!imagesEditMode" class="w-32 h-32 border rounded overflow-hidden">
                                            <ng-container *ngIf="images.length; else noImage">
                                                <img class="w-full h-full object-cover"
                                                    [src]="images[currentImageIndex]">
                                            </ng-container>
                                            <ng-template #noImage>
                                                <div
                                                    class="flex items-center justify-center w-full h-full rounded overflow-hidden uppercase text-8xl font-bold leading-none bg-gray-200 text-gray-600 dark:bg-gray-700 dark:text-gray-200">
                                                    <span class="text-md">NO IMAGE</span>
                                                </div>
                                            </ng-template>
                                        </div>
                                        <div
                                            class="absolute bottom-0 bg-black rounded-b opacity-50 w-full h-1/4 flex justify-center mt-0 whitespace-nowrap">
                                            <!-- Add Image  -->
                                            <div>
                                                <input id="new-image-file-input"
                                                    class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                    type="file" [multiple]="false" [accept]="'image/jpeg, image/png'"
                                                    (change)="uploadImages(imageFileInput.files, []);" #imageFileInput>
                                                <label
                                                    class="flex items-center justify-center w-8 h-8 rounded-full cursor-pointer hover:bg-hover"
                                                    for="new-image-file-input" matTooltip="Add image" matRipple>
                                                    <mat-icon class="icon-size-5 text-white"
                                                        [svgIcon]="'heroicons_solid:plus-circle'"></mat-icon>
                                                </label>
                                            </div>
                                            <!-- Toggle Image Edit -->
                                            <div>
                                                <input id="new-image-edit-button"
                                                    class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                    type="button" (click)="toggleImagesEditMode()" mat-icon-button>
                                                <label
                                                    class="flex items-center justify-center w-8 h-8 rounded-full cursor-pointer hover:bg-hover"
                                                    for="new-image-edit-button" matTooltip="Edit image" matRipple>
                                                    <mat-icon *ngIf="imagesEditMode" class="icon-size-5 text-white"
                                                        [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                                    <mat-icon *ngIf="!imagesEditMode" class="icon-size-5 text-white"
                                                        [svgIcon]="'heroicons_solid:pencil-alt'"></mat-icon>
                                                </label>
                                            </div>
                                            <!-- Set Thumbnail -->
                                            <div>
                                                <div *ngIf="images.length && images.length > 1">
                                                    <input id="new-set-thumbnail-button"
                                                        class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                        type="button" (click)="setThumbnail(currentImageIndex)"
                                                        mat-icon-button>
                                                    <label
                                                        class="flex items-center justify-center w-8 h-8 rounded-full cursor-pointer hover:bg-hover"
                                                        for="new-set-thumbnail-button"
                                                        [matTooltip]="currentImageIndex !== thumbnailIndex ? 'Set thumbnail' : ''"
                                                        matRipple>
                                                        <mat-icon class="icon-size-5 text-white"
                                                            [svgIcon]="currentImageIndex === thumbnailIndex ? 'heroicons_solid:star' : 'heroicons_outline:star'">
                                                        </mat-icon>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                    <!-- Edit Image Frame -->
                                    <div *ngIf="imagesEditMode"
                                        class="flex flex-col items-center sm:items-start mb-8 sm:mb-0">
                                        <div
                                            class="relative flex items-center justify-center w-32 h-32 border rounded overflow-hidden ring-4 ring-bg-card">
                                            <!-- Upload / Remove Image to Overide Image -->
                                            <div class="absolute inset-0 bg-black bg-opacity-40 z-10"></div>
                                            <div class="absolute inset-0 flex items-center justify-center z-20">
                                                <!-- Add / Edit Image -->
                                                <div>
                                                    <input id="new-image-file-input"
                                                        class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                        type="file" [multiple]="false"
                                                        [accept]="'image/jpeg, image/png'"
                                                        (change)="uploadImages(imageFileInput.files, images, $event);"
                                                        #imageFileInput>
                                                    <label
                                                        class="flex items-center justify-center w-8 h-8 rounded-full cursor-pointer hover:bg-hover"
                                                        for="new-image-file-input" matRipple>
                                                        <mat-icon class="text-white"
                                                            [svgIcon]="'heroicons_outline:pencil-alt'"></mat-icon>
                                                    </label>
                                                </div>
                                                <!-- Remove Image -->
                                                <div *ngIf="images.length">
                                                    <input id="new-image-remove-button"
                                                        class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                        type="button" (click)="removeImage();resetCycleImages()"
                                                        mat-icon-button>
                                                    <label
                                                        class="flex items-center justify-center w-8 h-8 rounded-full cursor-pointer hover:bg-hover"
                                                        for="new-image-remove-button" matRipple>
                                                        <mat-icon class="text-white"
                                                            [svgIcon]="'heroicons_outline:trash'"></mat-icon>
                                                    </label>
                                                </div>
                                            </div>
                                            <!-- View Image -->
                                            <img class="object-cover w-full h-full" *ngIf="images.length"
                                                [src]="images[currentImageIndex]">
                                            <!-- View No Image -->
                                            <div class="flex items-center justify-center w-full h-full rounded overflow-hidden uppercase text-8xl font-bold leading-none bg-gray-200 text-gray-600 dark:bg-gray-700 dark:text-gray-200"
                                                *ngIf="!images.length">
                                                <span class="text-md">NO IMAGE</span>
                                            </div>
                                            <div
                                                class="absolute bottom-0 bg-black rounded-b opacity-60 w-full h-1/4 flex justify-center mt-0 whitespace-nowrap z-30">
                                                <!-- Toggle Image Edit -->
                                                <div>
                                                    <input id="new-image-edit-button"
                                                        class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                        type="button" (click)="toggleImagesEditMode()" mat-icon-button>
                                                    <label
                                                        class="flex items-center justify-center w-8 h-8 rounded-full cursor-pointer hover:bg-hover"
                                                        for="new-image-edit-button"
                                                        [matTooltip]="imagesEditMode ? 'Close edit image' : 'Edit image'"
                                                        matRipple>
                                                        <mat-icon *ngIf="imagesEditMode" class="icon-size-5 text-white"
                                                            [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                                        <mat-icon *ngIf="!imagesEditMode" class="icon-size-5 text-white"
                                                            [svgIcon]="'heroicons_solid:pencil-alt'"></mat-icon>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Image Cycle -->
                                    <div class="flex items-center mt-0 whitespace-nowrap"
                                        [ngClass]="images.length ? 'visible' : 'invisible'">

                                        <input id="image-cycle-left"
                                            class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                            type="button" (click)="cycleImages(false)" mat-icon-button>

                                        <label
                                            class="flex items-center justify-center w-8 h-8 rounded-full cursor-pointer hover:bg-hover"
                                            for="image-cycle-left" matRipple>
                                            <mat-icon class="icon-size-5"
                                                [svgIcon]="'heroicons_solid:arrow-narrow-left'"></mat-icon>
                                        </label>

                                        <span class="font-sm mx-2">
                                            {{currentImageIndex + 1}} of {{images.length}}
                                        </span>

                                        <input id="image-cycle-right"
                                            class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                            type="button" (click)="cycleImages(true)" mat-icon-button>

                                        <label
                                            class="flex items-center justify-center w-8 h-8 rounded-full cursor-pointer hover:bg-hover"
                                            for="image-cycle-right" matRipple>
                                            <mat-icon class="icon-size-5"
                                                [svgIcon]="'heroicons_solid:arrow-narrow-right'"></mat-icon>
                                        </label>
                                    </div>
                                </div>
                                <!-- Resource status -->
                                <div class="flex flex-col mt-4 w-full">
                                    <mat-form-field class="w-full" floatLabel="always">
                                        <mat-label class="font-medium">Resource status</mat-label>
                                        <mat-select required floatLabel="always" placeholder="Select one option"
                                            [formControlName]="'status'"
                                            (selectionChange)="addResourceForm.get('step1').get('status').patchValue(statusSelector.value)"
                                            (selectionChange)="statusSelector.value === 'OUTOFSTOCK' ? addResourceForm.get('step1').get('availableStock').patchValue(0) : ''"
                                            (selectionChange)="statusSelector.value === 'ACTIVE' && (store$.verticalCode === 'FnB' || store$.verticalCode === 'FnB_PK') ? 
                                              addResourceForm.get('step1').get('allowOutOfStockPurchases').patchValue(true) : ''"
                                            #statusSelector="matSelect">
                                            <mat-select-trigger>
                                                <span class="flex items-center">
                                                    <span>{{ statusSelector.triggerValue }}</span>
                                                </span>
                                            </mat-select-trigger>
                                            <div>
                                                <mat-option [value]="'ACTIVE'">Active</mat-option>
                                                <mat-option [value]="'INACTIVE'">Inactive</mat-option>
                                                <mat-option [value]="'DEFAULT'">Default</mat-option>
                                                <mat-option [value]="'ONLEAVE'">On leave</mat-option>
                                            </div>
                                        </mat-select>
                                    </mat-form-field>
                                </div>
                            </div>

                            <!-- Name, Description, SKU, Price , Packing Size-->
                            <div class="flex flex-col md:flex-row w-full lg:w-4/12 lg:px-4 mt-0 md:mt-0">
                                <!-- Name, Description -->
                                <div class="flex flex-col w-full md:pr-2 lg:w-3/3">

                                    <!-- Name -->
                                    <!-- Name -->
                                    <mat-form-field class="w-full" appearance="fill" floatLabel="always">
                                        <mat-label>Name</mat-label>
                                        <input matInput required
                                            [placeholder]="'Insert ' + ((data['productType'] === 'combo') ? 'combo' : 'product') + ' name'"
                                            [formControlName]="'name'" (change)="generateSku()"
                                            (change)="checkProductName($event.target.value)">
                                        <mat-error
                                            *ngIf="addResourceForm.get('step1').get('name').hasError('required')">
                                            Required
                                        </mat-error>
                                        <mat-error
                                            *ngIf="addResourceForm.get('step1').get('name').hasError('productAlreadyExists')">
                                            '{{addResourceForm.get('step1').get('name').value.trim()}}' already exists
                                        </mat-error>
                                    </mat-form-field>

                                    <!-- SKU/Code -->
                                    <mat-form-field class="w-full" appearance="fill" floatLabel="always">
                                        <mat-label>Code</mat-label>
                                        <input matInput required [formControlName]="'sku'" placeholder="Insert Code">
                                        <mat-error *ngIf="addResourceForm.get('step1').get('sku').hasError('required')">
                                            Required
                                        </mat-error>
                                    </mat-form-field>

                                    <!-- Price/Fee/Rate -->
                                    <mat-form-field class="w-full" appearance="fill" floatLabel="always">
                                        <mat-label>Fee/Rate</mat-label>
                                        <span matSuffix>{{store$.regionCountry.currencySymbol}}</span>
                                        <input matInput required [formControlName]="'price'"
                                            placeholder="Insert Rate/Fee" type="number">
                                        <mat-error
                                            *ngIf="addResourceForm.get('step1').get('price').hasError('required')">
                                            Required
                                        </mat-error>
                                    </mat-form-field>

                                    <!-- Available stock/Number Of Weeks Reservable -->
                                    <div
                                        *ngIf="store$.verticalCode === 'E-Commerce' || store$.verticalCode === 'ECommerce_PK' || store$.verticalCode === 'e-commerce-b2b2c'">
                                        <span class="mb-2 font-medium leading-tight">Number Of Weeks Reservable
                                            <mat-icon
                                                matTooltip="Set the number of weeks a resource can be reserved for"
                                                class="transform scale-75"
                                                [svgIcon]="'heroicons_solid:question-mark-circle'">
                                            </mat-icon>
                                        </span>
                                        <mat-form-field class="w-full" appearance="fill" floatLabel="always">
                                            <input (input)="(addResourceForm.get('step1').get('availableStock').value > 0 && addResourceForm.get('step1').get('status').value === 'OUTOFSTOCK') ? 
                      addResourceForm.get('step1').get('status').patchValue('ACTIVE') : ''" (input)="(addResourceForm.get('step1').get('availableStock').value === 0) ? 
                      addResourceForm.get('step1').get('status').patchValue('OUTOFSTOCK') : ''"
                                                placeholder="Insert current stock" [formControlName]="'availableStock'"
                                                type="number" required matInput>
                                            <mat-error
                                                *ngIf="addResourceForm.get('step1').get('availableStock').hasError('required')">
                                                Required
                                            </mat-error>
                                        </mat-form-field>
                                    </div>
                                </div>

                            </div>




                            <!-- Category, Variant Toggle, Bulk Item, Vehicle Type -->
                            <div class="flex flex-col w-full lg:w-6/12">
                                <!-- Category -->
                                <div class="w-full">
                                    <span class="mb-px font-medium leading-tight">Category *</span>
                                    <div [ngClass]="addResourceForm.get('step1').get('categoryId').hasError('required') ? 'border-red-600' : 'border-gray-300'"
                                        class="mt-0.5 rounded-md border dark:border-gray-500 shadow-sm overflow-hidden">
                                        <!-- Header -->
                                        <div class="flex items-center -my-px py-0.5 px-3">
                                            <div class="flex items-center flex-auto min-w-0">
                                                <mat-icon class="icon-size-5" [svgIcon]="'heroicons_solid:search'">
                                                </mat-icon>
                                                <input class="min-w-0 ml-2 py-1 border-0" type="text"
                                                    placeholder="Enter Category name" (input)="filterCategories($event)"
                                                    (keydown)="filterCategoriesInputKeyDown($event)" [maxLength]="20"
                                                    #newCategoryInput>
                                            </div>
                                            <input id="category-edit-button"
                                                class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                type="button" (click)="toggleCategoriesEditMode()" mat-icon-button>

                                            <label
                                                class="flex items-center justify-center w-10 h-10 rounded-full cursor-pointer hover:bg-hover"
                                                for="category-edit-button" matRipple>
                                                <mat-icon *ngIf="!productCategoriesEditMode" class="icon-size-5"
                                                    [svgIcon]="'heroicons_solid:pencil-alt'"></mat-icon>
                                                <mat-icon *ngIf="productCategoriesEditMode" class="icon-size-5"
                                                    [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                            </label>
                                        </div>
                                        <!-- Available categories -->
                                        <div
                                            class="h-[150px] leading-none overflow-y-auto border-t border-gray-300 dark:border-gray-500">
                                            <!-- Categories -->
                                            <ng-container *ngIf="!productCategoriesEditMode">
                                                <ng-container
                                                    *ngFor="let category of filteredProductCategories; trackBy: trackByFn;">
                                                    <mat-checkbox class="flex items-center h-9 min-h-9 px-4"
                                                        [color]="'primary'"
                                                        [checked]="addResourceForm.get('step1').get('categoryId').value && addResourceForm.get('step1').get('categoryId').value.includes(category.id)"
                                                        (change)="toggleProductCategory(category, $event);">
                                                        {{category.name}}
                                                    </mat-checkbox>
                                                </ng-container>
                                            </ng-container>
                                            <!-- Categories editing -->
                                            <ng-container *ngIf="productCategoriesEditMode">
                                                <div class="p-4 space-y-1">
                                                    <ng-container
                                                        *ngFor="let category of filteredProductCategories; trackBy: trackByFn;">
                                                        <mat-form-field
                                                            class="fuse-mat-dense fuse-mat-no-subscript w-full">
                                                            <input matInput [id]="'category-input-' + category.id"
                                                                [value]="category.name"
                                                                [readonly]="!productCategoriesValueEditMode[i]"
                                                                (input)="updateLocalCategoryTitle(category, $event)">
                                                            <input [id]="'category-edit-' + category.id" type="button"
                                                                (click)="productCategoriesValueEditMode[i] = !productCategoriesValueEditMode[i]"
                                                                class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                                mat-button>
                                                            <label *ngIf="!productCategoriesValueEditMode[i]"
                                                                class="flex items-center justify-center p-2 rounded-full cursor-pointer hover:bg-hover"
                                                                [for]="'category-edit-' + category.id" matRipple>
                                                                <mat-icon class="icon-size-5"
                                                                    [svgIcon]="'heroicons_solid:pencil-alt'"></mat-icon>
                                                            </label>
                                                            <input [id]="'category-add-' + category.id" type="button"
                                                                (click)="productCategoriesValueEditMode[i] = !productCategoriesValueEditMode[i]; updateServerCategoryTitle(category, $event)"
                                                                class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                                mat-button>
                                                            <label *ngIf="productCategoriesValueEditMode[i]"
                                                                class="flex items-center justify-center p-2 rounded-full cursor-pointer hover:bg-hover"
                                                                [for]="'category-add-' + category.id" matRipple>
                                                                <mat-icon class="icon-size-5"
                                                                    [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                                            </label>
                                                            <input [id]="'category-remove-' + category.id" type="button"
                                                                (click)="deleteCategory(category)"
                                                                class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                                mat-button>
                                                            <label
                                                                class="flex items-center justify-center p-2 rounded-full cursor-pointer hover:bg-hover"
                                                                [for]="'category-remove-' + category.id" matRipple>
                                                                <mat-icon class="icon-size-5"
                                                                    [svgIcon]="'heroicons_solid:trash'"></mat-icon>
                                                            </label>
                                                        </mat-form-field>
                                                    </ng-container>
                                                </div>
                                            </ng-container>
                                            <div class="flex items-center h-8 min-h-8 -ml-0.5 pl-4 pr-3 leading-none cursor-pointer border-t hover:bg-gray-50 dark:hover:bg-hover"
                                                *ngIf="shouldShowCreateCategoryButton(newCategoryInput.value)"
                                                (click)="createCategory(newCategoryInput.value); newCategoryInput.value = ''"
                                                matRipple>
                                                <mat-icon class="mr-2 icon-size-5"
                                                    [svgIcon]="'heroicons_solid:plus-circle'"></mat-icon>
                                                <div class="break-all">Create "<b>{{newCategoryInput.value}}</b>"</div>
                                            </div>
                                        </div>
                                    </div>
                                    <mat-error class="text-sm font-medium"
                                        [ngClass]="addResourceForm.get('step1').get('categoryId').hasError('required') ? 'visible' : 'invisible'">
                                        Required
                                    </mat-error>
                                </div>

                                <!-- Description -->
                                <div class="w-full">
                                    <span class="font-medium leading-tight">Description *</span>
                                    <div class="mt-1 flex items-center -my-px w-full">
                                        <quill-editor class="w-full rounded-md"
                                            (focusout)="!this.addResourceForm.get('step1').get('description').value ? this.addResourceForm.get('step1').get('description').patchValue(null) : ''"
                                            [ngClass]="addResourceForm.get('step1').get('description').hasError('required') ? 'border border-red-600' : ''"
                                            [formControlName]="'description'" [modules]="quillModules"></quill-editor>
                                    </div>
                                    <mat-error class="text-sm font-medium"
                                        [ngClass]="addResourceForm.get('step1').get('description').hasError('required') ? 'visible' : 'invisible'">
                                        Required
                                    </mat-error>
                                </div>

                                <!-- Availability Toggle -->
                                <div class="flex flex-col w-full sm:pl-2 py-2 sm:py-0">
                                    <span class="mb-2 font-medium leading-tight">Availabilities
                                        <mat-icon matTooltip="Update Resource Availabilites?"
                                            class="transform scale-75"
                                            [svgIcon]="'heroicons_solid:question-mark-circle'">
                                        </mat-icon>
                                    </span>
                                    <div class="mt-0 flex items-center justify-between -my-px w-full">
                                        <mat-slide-toggle [formControlName]="'isAvailabilityToggle'"
                                            [color]="'primary'">
                                            {{addResourceForm.get('step1').get("isAvailabilityToggle").value === true ?
                                            'Yes' :
                                            'No'}}
                                        </mat-slide-toggle>
                                    </div>
                                </div>

                            </div>
                        </div>

                    </div>
                    <!-- Delete, Cancel, Back, Next buttons container -->
                    <div class="grid grid-cols-4 mt-3">
                        <!-- Delete button  -->
                        <div class="justify-self-start pl-2">
                            <!-- Delete button -->
                            <input id="product-remove-button" type="button" (click)="deleteSelectedResource()"
                                class="absolute h-0 w-0 opacity-0 invisible pointer-events-none" mat-button>
                            <label
                                class="flex items-center justify-center h-10 px-4 border rounded border-red-300 dark:border-red-500 cursor-pointer hover:bg-hover"
                                for="product-remove-button" matRipple>
                                <span class="hidden sm:block justify-center">Delete</span>
                                <mat-icon class="sm:ml-1" [color]="'warn'" [svgIcon]="'heroicons_outline:trash'">
                                </mat-icon>
                            </label>

                        </div>
                        <!-- Cancel, Next, Update buttons -->
                        <div class="justify-self-end flex col-span-3">
                            <!-- Flash message -->
                            <div class="flex items-center mr-4" [ngClass]="flashMessage ? 'visible' : 'invisible'">
                                <ng-container *ngIf="flashMessage === 'success'">
                                    <mat-icon class="text-green-500" [svgIcon]="'heroicons_outline:check'"></mat-icon>
                                    <span class="ml-2">Resource updated</span>
                                </ng-container>
                                <ng-container *ngIf="flashMessage === 'error'">
                                    <mat-icon class="text-red-500" [svgIcon]="'heroicons_outline:x'"></mat-icon>
                                    <span class="ml-2">An error occurred, try again!</span>
                                </ng-container>
                            </div>
                            <button mat-flat-button
                                class="sm:w-24 mr-2 bg-gray-300 hover:bg-gray-500 border border-gray-500"
                                [color]="'gray'" (click)="cancelAddProduct()">
                                <mat-icon *ngIf="!currentScreenSize.includes('sm')" class="text-white icon-size-5"
                                    [svgIcon]="'heroicons_outline:x'">
                                </mat-icon>
                                <span class="hidden sm:block justify-center">
                                    Cancel
                                </span>
                            </button>
                            <!-- Next Resource Availability button -->
                            <button *ngIf="addResourceForm.get('step1').get('isAvailabilityToggle').value === true"
                                class="sm:w-24" mat-flat-button [color]="'primary'"
                                [disabled]="horizontalStepperStep1.stepControl.invalid" type="button" matStepperNext>
                                <mat-icon *ngIf="!currentScreenSize.includes('sm')" class="text-white icon-size-5"
                                    [svgIcon]="'heroicons_outline:chevron-right'">
                                </mat-icon>
                                <span class="hidden sm:block justify-center">
                                    Next
                                </span>
                            </button>
                            <!-- Update button -->
                            <button *ngIf="addResourceForm.get('step1').get('isAvailabilityToggle').value === false"
                                class="sm:w-24" [ngClass]="isLoading ? 'cursor-wait' : 'cursor-pointer'" mat-flat-button
                                [color]="'primary'"
                                [disabled]="isLoading || horizontalStepperStep1.stepControl.pristine || horizontalStepperStep1.stepControl.invalid"
                                type="button" (click)="updateResourceMethod()" matStepperNext>
                                <mat-icon *ngIf="!currentScreenSize.includes('sm')" class="text-white icon-size-5"
                                    [svgIcon]="'heroicons_outline:check'">
                                </mat-icon>
                                <span class="hidden sm:block justify-center">
                                    Update
                                </span>
                            </button>

                        </div>
                    </div>
                </mat-step>

                <!-- Availability section -->

                <mat-step *ngIf="addResourceForm.get('step1').get('isAvailabilityToggle').value === true"
                    formArrayName="step2" [stepControl]="addResourceForm.get('step2')" #horizontalStepperStep2>
                    <ng-template matStepLabel>Resource Availability</ng-template>
                    <div
                        class="content flex flex-col h-full sm:h-auto sm:flex-row mb-3 w-full overflow-hidden sm:overflow-y-auto">
                        <!-- Add discount Tier -->
                        <fieldset
                            class="border border-solid border-gray-300 rounded p-2 w-full sm:w-1/3 sm:mr-2 mb-2 sm:mb-0">
                            <legend class="text font-bold px-2">Add Resource Availability</legend>
                            <!-- Insert discount tier -->
                            <div class="flex flex-col">

                                <!-- Min Sub Total, Discount Amount -->
                                <div class="flex flex-row sm:flex-col">
                                    <!-- Min Sub Total -->
                                    <div class="flex flex-col w-1/2 sm:w-full mr-1 sm:mr-0">
                                        <div class="flex flex-row w-full items-center">
                                            <!--Availability Day-->
                                            <mat-form-field class="flex flex-col w-full fuse-mat-emphasized-affix"
                                                appearance="fill" floatLabel="always">
                                                <mat-label>Availability Day</mat-label>
                                                <mat-select [(ngModel)]="availabilityDay"
                                                    [ngModelOptions]="{standalone: true}"
                                                    (selectionChange)="validateAvailability('availabilityDay' ,$event.value)">
                                                    <mat-option value="EVERYDAY">Everyday</mat-option>
                                                    <mat-option value="MONDAY_FRIDAY">Monday-Friday</mat-option>
                                                    <mat-option value="SATURDAY_SUNDAY">Saturday-Sunday</mat-option>
                                                    <mat-option value="MONDAY">Monday</mat-option>
                                                    <mat-option value="TUESDAY">Tuesday</mat-option>
                                                    <mat-option value="WEDNESDAY">Wednesday</mat-option>
                                                    <mat-option value="THURSDAY">Thursday</mat-option>
                                                    <mat-option value="FRIDAY">Friday</mat-option>
                                                    <mat-option value="SATURDAY">Saturday</mat-option>
                                                    <mat-option value="SUNDAY">Sunday</mat-option>
                                                </mat-select>
                                            </mat-form-field>

                                        </div>
                                        <mat-form-field class="w-full fuse-mat-emphasized-affix" appearance="fill"
                                            floatLabel="always">
                                            <mat-label>Duration In Minutes</mat-label>
                                            <input type="number" matInput placeholder="Insert Slot Duration In Minutes"
                                                [(ngModel)]="durationInMinutes" [ngModelOptions]="{standalone: true}"
                                                change="validateAvailability('durationInMinutes',$event.value)"
                                                required />
                                        </mat-form-field>
                                    </div>

                                    <!-- Start Time -->
                                    <div class="w-full flex flex-col">
                                        <div class="font-semibold mb-2 w-full">Start time</div>
                                        <div class="w-full flex flex-col sm:flex-row">
                                            <mat-form-field floatLabel="always" class="w-full fuse-mat-emphasized-affix"
                                                appearance="fill">
                                                <time-selector (change)="checkDateTime($event.value)" [required]="true"
                                                    class="w-full" matInput type="time" [(ngModel)]="startTime"
                                                    [ngModelOptions]="{standalone: true}">
                                                </time-selector>
                                                <mat-icon *ngIf="currentScreenSize.includes('sm') ? true : false"
                                                    matPrefix [svgIcon]="'heroicons_outline:clock'">
                                                </mat-icon>
                                            </mat-form-field>
                                        </div>
                                    </div>

                                    <!-- End Time -->
                                    <div class="w-full flex flex-col">
                                        <div class="font-semibold mb-2 w-full">End time</div>
                                        <div class="w-full flex flex-col sm:flex-row">
                                            <mat-form-field floatLabel="always" class="w-full fuse-mat-emphasized-affix"
                                                appearance="fill">
                                                <time-selector (change)="checkDateTime($event.value)" [required]="true"
                                                    class="w-full" matInput type="time" [(ngModel)]="endTime"
                                                    [ngModelOptions]="{standalone: true}">
                                                </time-selector>
                                                <mat-icon *ngIf="currentScreenSize.includes('sm') ? true : false"
                                                    matPrefix [svgIcon]="'heroicons_outline:clock'">
                                                </mat-icon>
                                            </mat-form-field>
                                        </div>
                                    </div>

                                    <div class="flex flex-col w-1/2 sm:w-full mr-1 sm:mr-0">
                                        <div class="flex flex-row w-full items-center">
                                            <mat-form-field class="w-full" appearance="fill" floatLabel="always">
                                                <mat-label>UTC Offset Hours</mat-label>
                                                <mat-select [(ngModel)]="offsetHours"
                                                    [ngModelOptions]="{standalone: true}"
                                                    (selectionChange)="validateAvailability('offset' ,$event.value)">
                                                    <mat-option [value]="timezone"
                                                        *ngFor="let timezone of utcTimezones">
                                                        {{timezone.text}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>
                                        </div>
                                    </div>

                                    <div class="flex flex-col w-1/2 sm:w-full mr-1 sm:mr-0">
                                        <div class="flex flex-row w-full items-center">
                                            <mat-form-field class="w-full" appearance="fill" floatLabel="always">
                                                <mat-label>Confirmation Method</mat-label>
                                                <mat-select [(ngModel)]="confirmationMethodStr"
                                                    [ngModelOptions]="{standalone: true}"
                                                    (selectionChange)="validateAvailability('confirmationMethod' ,$event.value)">
                                                    <mat-option [value]="method"
                                                        *ngFor="let method of confirmationMethod">
                                                        {{method}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>
                                        </div>
                                    </div>
                                    <!-- Dbuttons Insert Discount Tier-->
                                    <div class="flex flex-row w-full justify-end">
                                        <button class="text-white" type="button" mat-flat-button
                                            (click)="createNewResourceAvailability()" [color]="'primary'">
                                            <span class="pr-2">Add Availability</span>
                                            <mat-icon class="text-white icon-size-5"
                                                [svgIcon]="'heroicons_outline:plus-circle'"></mat-icon>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                        <!-- Discount tier list -->
                        <fieldset class="border border-solid border-gray-300 rounded p-2 w-full sm:w-2/3">
                            <legend class="text font-bold px-2">Resource Availability List</legend>

                            <div class="flex flex-col w-full">
                                <ng-container>
                                    <div class="grid overflow-auto rounded">
                                        <!-- Header -->
                                        <div class="edit-order-discount-grid sticky grid gap-1 sm:gap-4 py-4 shadow text-md font-semibold text-secondary bg-gray-50 dark:bg-black dark:bg-opacity-5"
                                            matSort matSortDisableClear>
                                            <div class="hidden sm:block"></div>
                                            <div [mat-sort-header]="'min-order'">
                                                Availability day
                                            </div>
                                            <div [mat-sort-header]="'discount-amount'">
                                                Start time
                                            </div>
                                            <div [mat-sort-header]="'type'">
                                                End time
                                            </div>
                                            <div [mat-sort-header]="'durationInMinutes'">
                                                Duration in minutes
                                            </div>
                                            <div [mat-sort-header]="'offsetHours'">
                                                Offset Hours
                                            </div>
                                            <div [mat-sort-header]="'confirmationMethod'">
                                                Confirmation Method
                                            </div>
                                            <div>
                                                Action
                                            </div>
                                        </div>
                                        <!-- Rows -->
                                        <div class="h-auto overflow-y-auto">
                                            <div *ngFor="let resourceAvailability of addResourceForm.get('step2')['controls']; let i = index;"
                                                [formGroupName]="i">
                                                <!-- Variant Header -->
                                                <div
                                                    class="edit-order-discount-grid grid items-center gap-4 mt-4 border-b">
                                                    <div class="hidden sm:block"></div>
                                                    <!-- Availability Day -->
                                                    <div>
                                                        <mat-form-field class="w-full" appearance="fill">
                                                            <mat-select [formControlName]="'availabilityDay'"
                                                                [disabled]="!storeDiscountTierListValueEditMode[i]"
                                                                (selectionChange)="validateAvailability('availabilityDay' ,$event.value)">
                                                                <mat-option value="EVERYDAY">Everyday</mat-option>
                                                                <mat-option value="MONDAY_FRIDAY">Monday-Friday
                                                                </mat-option>
                                                                <mat-option value="SATURDAY_SUNDAY">Saturday-Sunday
                                                                </mat-option>
                                                                <mat-option value="MONDAY">Monday</mat-option>
                                                                <mat-option value="TUESDAY">Tuesday</mat-option>
                                                                <mat-option value="WEDNESDAY">Wednesday</mat-option>
                                                                <mat-option value="THURSDAY">Thursday</mat-option>
                                                                <mat-option value="FRIDAY">Friday</mat-option>
                                                                <mat-option value="SATURDAY">Saturday</mat-option>
                                                                <mat-option value="SUNDAY">Sunday</mat-option>
                                                            </mat-select>
                                                        </mat-form-field>
                                                    </div>

                                                    <!-- start Time -->
                                                    <div>
                                                        <mat-form-field class="w-full"
                                                            [ngClass]="{'text-gray-400' : !storeDiscountTierListValueEditMode[i]}">
                                                            <input type="time" required matInput
                                                                [formControlName]="'startTime'"
                                                                [readonly]="!storeDiscountTierListValueEditMode[i]">
                                                        </mat-form-field>
                                                    </div>

                                                    <!-- endtime -->
                                                    <div>
                                                        <mat-form-field class="w-full"
                                                            [ngClass]="{'text-gray-400' : !storeDiscountTierListValueEditMode[i]}">
                                                            <input type="time" required matInput
                                                                [formControlName]="'endTime'"
                                                                [readonly]="!storeDiscountTierListValueEditMode[i]">
                                                        </mat-form-field>
                                                    </div>

                                                    <!-- Duration In Minutes -->
                                                    <div>
                                                        <mat-form-field class="w-full"
                                                            [ngClass]="{'text-gray-400' : !storeDiscountTierListValueEditMode[i]}">
                                                            <input type="number" required matInput
                                                                [formControlName]="'durationInMinutes'"
                                                                [readonly]="!storeDiscountTierListValueEditMode[i]">
                                                        </mat-form-field>
                                                    </div>

                                                    <!-- Offset Hours -->
                                                    <div *ngIf="!storeDiscountTierListValueEditMode[i]">
                                                        <mat-form-field class="w-full"
                                                            [ngClass]="{'text-gray-400' : !storeDiscountTierListValueEditMode[i]}">
                                                            <input type="text" required matInput
                                                                [formControlName]="'offsetHours'"
                                                                [readonly]="!storeDiscountTierListValueEditMode[i]">
                                                        </mat-form-field>
                                                    </div>

                                                    <div *ngIf="storeDiscountTierListValueEditMode[i]">
                                                        <mat-form-field class="w-full" appearance="fill">
                                                            <mat-select [formControlName]="'offsetHours'"
                                                                (selectionChange)="validateAvailability('offset' ,$event.value)">
                                                                <mat-option [value]="timezone.offset"
                                                                    *ngFor="let timezone of utcTimezones">
                                                                    {{timezone.text}}
                                                                </mat-option>
                                                            </mat-select>
                                                        </mat-form-field>
                                                    </div>

                                                    <!-- Confirmation Method-->
                                                    <div>
                                                        <mat-form-field class="w-full" appearance="fill">
                                                            <mat-select [formControlName]="'confirmationMethod'"
                                                                [disabled]="!storeDiscountTierListValueEditMode[i]"
                                                                (selectionChange)="validateAvailability('confirmationMethod' ,$event.value)">
                                                                <mat-option [value]="method"
                                                                    *ngFor="let method of confirmationMethod">
                                                                    {{method}}
                                                                </mat-option>
                                                            </mat-select>
                                                        </mat-form-field>
                                                    </div>
                                                    <!-- Action Button -->
                                                    <div>
                                                        <div class="flex flex-wrap items-center justify-center ">
                                                            <div
                                                                class="flex flex-row w-full items-center justify-center">

                                                                <input
                                                                    class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                                    type="button"
                                                                    [id]="'edit-discount-tier-btn' + resourceAvailability.value.id"
                                                                    (click)="storeDiscountTierListValueEditMode[i] = !storeDiscountTierListValueEditMode[i]">
                                                                <label *ngIf="!storeDiscountTierListValueEditMode[i]"
                                                                    class="flex items-center justify-center w-9 h-9 rounded-full cursor-pointer bg-blue-600 hover:bg-blue-400  mr-3 mb-3"
                                                                    [for]="'edit-discount-tier-btn' + resourceAvailability.value.id"
                                                                    matRipple>
                                                                    <mat-icon class="text-white icon-size-5"
                                                                        [svgIcon]="'heroicons_outline:pencil-alt'">
                                                                    </mat-icon>
                                                                </label>

                                                                <input
                                                                    class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                                    type="button"
                                                                    [id]="'update-discount-tier-btn' + resourceAvailability.value.id"
                                                                    (click)="storeDiscountTierListValueEditMode[i] = !storeDiscountTierListValueEditMode[i]"
                                                                    (click)="updateSelectedResourceAvailability(resourceAvailability)">
                                                                <label *ngIf="storeDiscountTierListValueEditMode[i]"
                                                                    class="flex items-center justify-center w-9 h-9 rounded-full cursor-pointer bg-blue-600 hover:bg-blue-400  mr-3 mb-3"
                                                                    [for]="'update-discount-tier-btn' + resourceAvailability.value.id"
                                                                    matRipple>
                                                                    <mat-icon class="text-white icon-size-5"
                                                                        [svgIcon]="'heroicons_outline:check'">
                                                                    </mat-icon>
                                                                </label>


                                                                <input
                                                                    class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                                    type="button"
                                                                    [id]="'delete-discount-tier-btn' + resourceAvailability.value.id"
                                                                    (click)="deleteSelectedResourceAvailability(resourceAvailability.value.id)">
                                                                <label
                                                                    class="flex items-center justify-center w-9 h-9 rounded-full cursor-pointer bg-warn hover:bg-warn-700 mb-3"
                                                                    [for]="'delete-discount-tier-btn' + resourceAvailability.value.id"
                                                                    matRipple>
                                                                    <mat-icon class="text-white icon-size-5"
                                                                        [svgIcon]="'heroicons_outline:trash'">
                                                                    </mat-icon>
                                                                </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </ng-container>
                            </div>
                        </fieldset>
                    </div>

                    <div class="w-full flex flex-row items-center justify-between">

                        <!-- Delete -->
                        <div class="justify-self-start">
                            <input id="product-remove-button" type="button" (click)="deleteSelectedResource()"
                                class="absolute h-0 w-0 opacity-0 invisible pointer-events-none" mat-button>
                            <label
                                class="flex items-center justify-center h-10 px-4 border rounded border-red-300 dark:border-red-500 cursor-pointer hover:bg-hover"
                                for="product-remove-button" matRipple>
                                <span>Delete</span>
                                <mat-icon class="ml-1" [color]="'warn'" [svgIcon]="'heroicons_outline:trash'">
                                </mat-icon>
                            </label>
                        </div>

                        <!-- Flash message -->
                        <div class="items-center flex mr-4" [ngClass]="flashMessage ? 'visible' : 'invisible'">
                            <ng-container *ngIf="flashMessage === 'success'">
                                <mat-icon class="text-green-500" [svgIcon]="'heroicons_outline:check'"></mat-icon>
                                <span class="ml-2">Resource updated</span>
                            </ng-container>
                            <ng-container *ngIf="flashMessage === 'error'">
                                <mat-icon class="text-red-500" [svgIcon]="'heroicons_outline:x'"></mat-icon>
                                <span class="ml-2">An error occurred, try again!</span>
                            </ng-container>
                        </div>

                        <!-- Back, Update button -->
                        <div class="flex flex-row justify-end">
                            <!-- Back button -->
                            <button class="px-8 mr-2" mat-flat-button [color]="'accent'" type="button"
                                matStepperPrevious>
                                Back
                            </button>
                            <!-- Update button -->
                            <button class="px-8" [ngClass]="isLoading ? 'cursor-wait' : 'cursor-pointer'"
                                mat-flat-button [disabled]="isLoading" [color]="'primary'" type="button"
                                (click)="updateResourceMethod()">
                                Update
                            </button>
                        </div>
                    </div>
                </mat-step>
            </mat-horizontal-stepper>
        </form>
    </div>
</div>