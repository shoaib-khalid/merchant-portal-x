<div class="flex flex-col max-w-260 md:min-w-160 -m-6">

    <!-- Compose form -->
    <!-- <div class="flex flex-col flex-auto p-1 sm:p-2 max-h-140 ">

    </div> -->
    <div class="flex px-4">
        <!-- Selected product form -->
        <form
            class="flex flex-col w-full"
            [formGroup]="addProductForm">
            <mat-horizontal-stepper
            [linear]="true"
            #horizontalStepper>
                <!-- Basic info section -->
                <mat-step
                    [formGroupName]="'step1'"
                    [stepControl]="addProductForm.get('step1')"
                    #horizontalStepperStep1>
                    <ng-template matStepLabel>Basic information</ng-template>
                    <!-- <p class="my-6 font-medium">
                        Fill in your basic information to let us know your preferences
                    </p> -->

                    <!-- Content -->
                    <div class="content flex flex-col overflow-y-auto">

                        <!-- Main -->
                        <div class="flex px-2 flex-col lg:flex-row mb-4 lg:mb-0 w-full">
                            <!-- Product images and status -->
                            <div class="flex flex-col items-center w-full lg:w-2/12 sm:items-start lg:pb-1">
                                <div class="flex flex-col items-center w-full">
                                    <!-- Image Section  -->
                                    <div class="relative" #imageSearchPanelOrigin>
                                        <!-- Image Frame -->
                                        <div class="w-32 h-32 border rounded overflow-hidden">
                                            <ng-container *ngIf="productImages.length; else noImage">
                                                <img
                                                    class="w-full h-full object-cover"
                                                    [src]="productImages[currentImageIndex].preview">
                                            </ng-container>
                                            <ng-template #noImage>
                                                <div
                                                    class="flex items-center justify-center w-full h-full rounded overflow-hidden uppercase text-8xl font-bold leading-none bg-gray-200 text-gray-600 dark:bg-gray-700 dark:text-gray-200"
                                                >
                                                    <span class="text-md">NO IMAGE</span> 
                                                </div>
                                            </ng-template>
                                        </div>
                                        <!-- Edit/Add mode on body-->
                                        <div *ngIf="imagesChangeMode.isOn" class="absolute top-0 bg-black rounded bg-opacity-50 inset-0 flex justify-center items-center">
                                            <ng-container *ngIf="imagesChangeMode.mode.edit">
                                                <!-- Add / Edit Image -->
                                                <!-- <div>
                                                    <input
                                                        id="new-image-file-input"
                                                        class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                        type="file"
                                                        [multiple]="false"
                                                        [accept]="'image/jpeg, image/png'"
                                                        (change)="uploadImages(imageFileInput.files, productImages.preview, $event);"
                                                        #imageFileInput>
                                                    <label
                                                        class="flex items-center justify-center w-8 h-8 rounded-full cursor-pointer hover:bg-hover"
                                                        for="new-image-file-input"
                                                        matRipple>
                                                        <mat-icon
                                                            class="text-white"
                                                            [svgIcon]="'heroicons_outline:pencil-alt'"></mat-icon>
                                                    </label>
                                                </div> -->
                                                <!-- Remove Image -->
                                                <div *ngIf="productImages.length">
                                                    <input
                                                        id="new-image-remove-button"
                                                        class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                        type="button"
                                                        (click)="removeImage();resetCycleImages()"
                                                        mat-icon-button>
                                                    <label 
                                                        class="flex items-center justify-center w-8 h-8 rounded-full cursor-pointer hover:bg-hover"
                                                        for="new-image-remove-button"
                                                        [matTooltip]="'Delete this image'"
                                                        matRipple>
                                                        <mat-icon
                                                            class="text-white"
                                                            [svgIcon]="'heroicons_outline:trash'"></mat-icon>
                                                    </label>
                                                </div>
                                            </ng-container>
                                            <ng-container *ngIf="imagesChangeMode.mode.create">
                                                <!-- Add Image  -->
                                                <div>
                                                    <input
                                                        id="new-image-file-input"
                                                        class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                        type="file"
                                                        [multiple]="false"
                                                        [accept]="'image/jpeg, image/png'"
                                                        (change)="uploadImages(imageFileInput.files, []);"
                                                        #imageFileInput>
                                                    <label
                                                        class="flex items-center justify-center w-8 h-8 rounded-full cursor-pointer hover:bg-hover"
                                                        for="new-image-file-input"
                                                        matTooltip="Upload image"
                                                        matRipple>
                                                        <mat-icon
                                                            class="icon-size-5 text-white"
                                                            [svgIcon]="'heroicons_solid:upload'"></mat-icon>
                                                    </label>
                                                </div>
                                                <!-- Search Image  -->
                                                <div>
                                                    <input
                                                    id="search-image-button"
                                                    class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                    type="button"
                                                    (click)="openSearchImagePanel()"
                                                    mat-icon-button>
                                                    <label 
                                                        class="flex items-center justify-center w-8 h-8 rounded-full cursor-pointer hover:bg-hover"
                                                        for="search-image-button"
                                                        [matTooltip]="'Search image'"
                                                        matRipple>
                                                        <mat-icon
                                                            class="icon-size-5 text-white"
                                                            [svgIcon]="'heroicons_solid:search'"></mat-icon>
                                                    </label>
                                                </div>
                                            </ng-container>
                                        </div>
                                        <!-- Edit mode off footer-->
                                        <div *ngIf="!imagesChangeMode.isOn" class="absolute bottom-0 bg-black rounded-b bg-opacity-50 w-full h-1/4 flex justify-center mt-0 whitespace-nowrap">
                                            <!-- Add Image  -->
                                            <div>
                                                <input
                                                    id="new-image-file-input"
                                                    class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                    type="button"
                                                    (click)="toggleImagesEditMode(true, 'Add')"
                                                    mat-icon-button>
                                                <label
                                                    class="flex items-center justify-center w-8 h-8 rounded-full cursor-pointer hover:bg-hover"
                                                    for="new-image-file-input"
                                                    matTooltip="Add"
                                                    matRipple>
                                                    <mat-icon
                                                        class="icon-size-5 text-white"
                                                        [svgIcon]="'heroicons_solid:plus-circle'"></mat-icon>
                                                </label>
                                            </div>
                                            <!-- Toggle Image Edit -->
                                            <div *ngIf="productImages.length">
                                                <input
                                                    id="new-image-edit-button"
                                                    class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                    type="button"
                                                    (click)="toggleImagesEditMode(true, 'Edit')"
                                                    mat-icon-button
                                                >
                                                <label 
                                                    class="flex items-center justify-center w-8 h-8 rounded-full cursor-pointer hover:bg-hover"
                                                    for="new-image-edit-button"
                                                    matTooltip="Edit"
                                                    matRipple>
                                                    <mat-icon
                                                        class="icon-size-5 text-white"
                                                        [svgIcon]="'heroicons_solid:pencil-alt'"></mat-icon>
                                                </label>
                                            </div>
                                            <!-- Set Thumbnail -->
                                            <div>
                                                <div *ngIf="productImages.length && productImages.length > 1">
                                                    <input
                                                        id="new-set-thumbnail-button"
                                                        class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                        type="button"
                                                        (click)="setThumbnail(currentImageIndex)"
                                                        mat-icon-button>
                                                    <label 
                                                        class="flex items-center justify-center w-8 h-8 rounded-full cursor-pointer hover:bg-hover"
                                                        for="new-set-thumbnail-button"
                                                        [matTooltip]="productImages[currentImageIndex].isThumbnail !== true? 'Set thumbnail' : ''"
                                                        matRipple>
                                                        <mat-icon
                                                            class="icon-size-5 text-white"
                                                            [svgIcon]="productImages[currentImageIndex].isThumbnail === true ? 'heroicons_solid:star' : 'heroicons_outline:star'"></mat-icon>
                                                    </label>
                                                </div>
                                            </div>
                                            
                                        </div>
                                        <!-- Edit mode on footer-->
                                        <div *ngIf="imagesChangeMode.isOn" class="absolute bottom-0 bg-black rounded-b bg-opacity-50 w-full h-1/4 flex justify-center mt-0 whitespace-nowrap">
                                            <!-- Toggle Image Edit -->
                                            <div>
                                                <input
                                                    id="new-image-edit-button"
                                                    class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                    type="button"
                                                    (click)="toggleImagesEditMode(false, '')"
                                                    mat-icon-button
                                                >
                                                <label 
                                                    class="flex items-center justify-center w-8 h-8 rounded-full cursor-pointer hover:bg-hover"
                                                    for="new-image-edit-button"
                                                    [matTooltip]="'Done'"
                                                    matRipple>
                                                    <mat-icon
                                                        class="icon-size-5 text-white"
                                                        [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Image Cycle -->
                                    <div
                                        class="flex items-center mt-0 whitespace-nowrap"
                                        [ngClass]="productImages.length ? 'visible' : 'invisible'">
                                        <input
                                            id="image-cycle-left"
                                            class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                            type="button"
                                            (click)="cycleImages(false)"
                                            mat-icon-button>
                                    
                                        <label 
                                            class="flex items-center justify-center w-8 h-8 rounded-full cursor-pointer hover:bg-hover"
                                            for="image-cycle-left"
                                            matRipple>
                                            <mat-icon
                                                class="icon-size-5"
                                                [svgIcon]="'heroicons_solid:arrow-narrow-left'"></mat-icon>
                                        </label>
                                        <span class="font-sm mx-2">
                                            {{currentImageIndex + 1}} of {{productImages.length}}
                                        </span>
                                        <input
                                            id="image-cycle-right"
                                            class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                            type="button"
                                            (click)="cycleImages(true)"
                                            mat-icon-button>
                                    
                                        <label 
                                            class="flex items-center justify-center w-8 h-8 rounded-full cursor-pointer hover:bg-hover"
                                            for="image-cycle-right"
                                            matRipple>
                                            <mat-icon
                                                class="icon-size-5"
                                                [svgIcon]="'heroicons_solid:arrow-narrow-right'"></mat-icon>
                                        </label>
                                    </div>
                                    <!-- Image search panel  -->
                                    <ng-template #imageSearchPanel>
                                        <div class="w-60 md:w-72 rounded border shadow-md bg-card">
                                            <mat-form-field class="fuse-mat-dense fuse-mat-no-subscript fuse-mat-emphasized-affix w-full" floatLabel="always" #autocompleteField>
                                                <mat-icon class="text-primary" svgIcon="heroicons_outline:search"></mat-icon>
                                                <!-- <mat-label>Search</mat-label> -->
                                                <input
                                                    #searchImageInput
                                                    id="inputElement"
                                                    class="pl-4 text-sm"
                                                    matInput
                                                    [formControl]="searchImageControl"
                                                    [autocomplete]="'off'"
                                                    [placeholder]="'Search for product image'"
                                                    [matAutocomplete]="matAutocomplete"
                                                    >
                                                <!-- Search button -->
                                                <!-- <div *ngIf="currentScreenSize.includes('sm')" class="text-white font-semibold" matSuffix>
                                                    <button class="p-2.5 font-bold" (click)="goToSearch(searchControl.value);">Search</button>
                                                </div> -->
                                            </mat-form-field>
                                            <mat-autocomplete
                                                class="max-h-50 mt-1 rounded"
                                                [disableRipple]="true"
                                                #matAutocomplete="matAutocomplete">
                                                <ng-container *ngFor="let result of autoCompleteList; trackBy: trackByFn">
                                                    <mat-option
                                                        class="group relative h-10 px-3 text-sm hover:bg-gray-100 dark:hover:bg-hover"
                                                        (click)="selectImage(result);">
                                                        <ng-container *ngTemplateOutlet="imageResult; context: {$implicit: result}"></ng-container>
                                                    </mat-option>
                                                </ng-container>
                                            </mat-autocomplete>
                                            <!-- Image result template -->
                                            <ng-template
                                                #imageResult
                                                let-result>
                                                <div class="flex flex-row items-center justify-between gap-1">
                                                    <span class="truncate">{{result.name}}</span>
                                                    <img
                                                        matSuffix
                                                        class="w-auto max-h-9 rounded"
                                                        *ngIf="result.url"
                                                        [alt]="'Image'"
                                                        [src]="result.url">
                                                </div>
                                            </ng-template>
                                        </div>
                                    </ng-template>
                                </div>
                                <!-- Product status -->
                                <div class="flex flex-col mt-4 w-full">
                                    <mat-form-field class="w-full" floatLabel="always">
                                        <mat-label class="font-medium">Product status</mat-label>
                                        <mat-select
                                            required
                                            floatLabel="always"
                                            placeholder="Select one option"
                                            [formControlName]="'status'"
                                            (selectionChange)="changeProductStatus(statusSelector.value)"
                                            #statusSelector="matSelect"
                                            >
                                            <mat-select-trigger>
                                                <span class="flex items-center">
                                                    <span>{{ statusSelector.triggerValue }}</span>
                                                </span>
                                            </mat-select-trigger>
                                            <div>
                                                <mat-option [value]="'ACTIVE'">Active</mat-option>
                                                <mat-option [value]="'INACTIVE'">Inactive</mat-option>
                                                <mat-option [value]="'OUTOFSTOCK'">Out of Stock</mat-option>
                                            </div>
                                        </mat-select>
                                        <!-- <mat-slide-toggle
                                            [formControlName]="'status'"
                                            [color]="'primary'">
                                            {{addProductForm.get('step1').get('status').value === "ACTIVE" ? true : false}}
                                        </mat-slide-toggle> -->
                                        <!-- <mat-error *ngIf="addProductForm.get('step1').get('status').hasError('required')">
                                            Required
                                        </mat-error> -->
                                    </mat-form-field>
                                </div>
                            </div>

                            <!-- Name, Description, SKU, Price , Packing Size-->
                            <div class="flex flex-col md:flex-row w-full lg:w-7/12 lg:px-4 mt-0 md:mt-0">
                                <!-- Name, Description -->
                                <div class="flex flex-col w-full md:pr-2 lg:w-2/3">

                                    <!-- Name -->
                                    <mat-form-field class="w-full" appearance="fill" floatLabel="always">
                                        <mat-label>Name</mat-label>
                                        <input
                                            matInput
                                            required
                                            [placeholder]="'Insert ' + ((data['productType'] === 'combo') ? 'combo' : 'product') + ' name'"
                                            [formControlName]="'name'"
                                            (change)="generateSku($event.target.value)"
                                            (change)="checkProductName($event.target.value)"
                                        >
                                        <mat-error *ngIf="addProductForm.get('step1').get('name').hasError('required')">
                                            Required
                                        </mat-error>
                                        <mat-error *ngIf="addProductForm.get('step1').get('name').hasError('productAlreadyExists')">
                                            '{{addProductForm.get('step1').get('name').value.trim()}}' already exists
                                        </mat-error>

                                    </mat-form-field>

                                    <!-- Description -->
                                    <div class="w-full mb-0">
                                        <span class="font-medium leading-tight">Description *</span>
                                        <div class="mt-1 flex items-center -my-px w-full">
                                            <quill-editor
                                                class="w-full rounded-md"
                                                (focusout)="!this.addProductForm.get('step1').get('description').value ? this.addProductForm.get('step1').get('description').patchValue(null) : ''"
                                                [ngClass]="addProductForm.get('step1').get('description').hasError('required') ? 'border border-red-600' : ''"
                                                [formControlName]="'description'"
                                                [modules]="quillModules"></quill-editor>
                                            <!-- use (onContentChanged)="textChanged($event)" for limiting quil editor -->
                                        </div>
                                        <mat-error 
                                            class="text-sm font-medium"
                                            [ngClass]="addProductForm.get('step1').get('description').hasError('required') ? 'visible' : 'invisible'"
                                        >
                                            Required
                                        </mat-error> 
                                    </div>
                                </div>
                                
                                <!-- SKU, Price, Packing Size-->
                                <div class="flex flex-col w-full md:pl-2 lg:w-1/3">
                                    <!-- SKU -->
                                    <mat-form-field class="w-full" appearance="fill" floatLabel="always">
                                        <mat-label>SKU</mat-label>
                                        <input
                                            matInput
                                            required
                                            [formControlName]="'sku'"
                                            placeholder="Insert SKU">
                                        <mat-error *ngIf="addProductForm.get('step1').get('sku').hasError('required')">
                                            Required
                                        </mat-error>
                                    </mat-form-field>

                                    <!-- Price -->
                                    <mat-form-field 
                                        class="w-full"
                                        appearance="fill" floatLabel="always">
                                        <mat-label>Price</mat-label>
                                        <span matSuffix>{{store$.regionCountry.currencySymbol}}</span>
                                        <input
                                            matInput
                                            required
                                            [formControlName]="'price'"
                                            placeholder="Insert price"
                                            type="number">
                                        <mat-error *ngIf="addProductForm.get('step1').get('price').hasError('required')">
                                            Required
                                        </mat-error>
                                    </mat-form-field>

                                    <!-- Packing Size for Ecomm-->
                                    <mat-form-field 
                                        class="w-full"
                                        appearance="fill" floatLabel="always"
                                        *ngIf="store$.verticalCode === 'E-Commerce' || store$.verticalCode === 'ECommerce_PK' || store$.verticalCode === 'e-commerce-b2b2c'">
                                        <mat-label>Packing Size</mat-label>
                                        <mat-select
                                            required
                                            class="w-full"
                                            appearance="fill"
                                            [formControlName]="'packingSize'"
                                            [value]="packingSize"
                                            placeholder="Select one option"
                                            (selectionChange)="addProductForm.get('step1').get('packingSize').patchValue(packingSizeSelector.value)"
                                            #packingSizeSelector="matSelect"
                                            >
                                            <mat-select-trigger>
                                                <span class="flex items-center">
                                                    <span>{{ packingSizeSelector.triggerValue }}</span>
                                                </span>
                                            </mat-select-trigger>
                                            <div>
                                                <mat-option [value]="'S'">Small (below 0.5KG)</mat-option>
                                                <mat-option [value]="'M'">Medium (0.5 - 1.0KG)</mat-option>
                                                <mat-option [value]="'L'">Large (1.0 - 2.0KG)</mat-option>
                                                <mat-option [value]="'XL'">Extra Large (above 2.0KG)</mat-option>
                                            </div>
                                        </mat-select>
                                        <mat-error *ngIf="addProductForm.get('step1').get('packingSize').hasError('required')">
                                            Required
                                        </mat-error>
                                    </mat-form-field>

                                    <!-- Variants Toggle for Fnb -->
                                    <div 
                                        *ngIf="(store$.verticalCode === 'FnB' || store$.verticalCode === 'FnB_PK') && (productType != 'combo')"
                                        class="flex flex-col w-full pb-4"
                                    >
                                        <span class="pb-1 font-medium leading-tight">Variants 
                                            <mat-icon
                                                matTooltip="Does this product have variants?"
                                                class="transform scale-75"
                                                [svgIcon]="'heroicons_solid:question-mark-circle'">
                                            </mat-icon>
                                        </span>
                                        <div class="mt-0 flex items-center -my-px w-full">
                                            <mat-slide-toggle
                                                class="pr-4"
                                                [formControlName]="'isVariants'"
                                                [color]="'primary'"
                                                (change)="(addProductForm.get('step1').get('isVariants').value === false) ? deleteAllVariantsConfirmation() : return"
                                                >
                                                {{addProductForm.get('step1').get('isVariants').value === true ? 'Yes' : 'No'}}
                                            </mat-slide-toggle>
                                            
                                        </div>
                                    </div>
                                </div>
                            </div>

                            
                            <!-- Category, Variant Toggle, Bulk Item, Vehicle Type -->
                            <div class="flex flex-col w-full lg:w-3/12">
                                <!-- Parent categories -->
                                <div class="w-full">
                                    <mat-form-field class="w-full">
                                        <mat-label>Top Tier Category</mat-label>
                                        <mat-select
                                            class="w-full"
                                            [(ngModel)]="selectedParentCategory"
                                            [ngModelOptions]="{standalone: true}"
                                            disabled
                                        >
                                            <div>
                                                <mat-option *ngFor="let listing of parentCategoriesOptions;" [value]="listing.id">
                                                    {{listing.name}}
                                                </mat-option>
                                            </div>
                                        </mat-select>
                                    </mat-form-field>
                                </div>
                                <!-- Category -->
                                <div class="w-full">
                                    <span class="mb-px font-medium leading-tight">Category *</span>
                                    <div 
                                        [ngClass]="addProductForm.get('step1').get('categoryId').hasError('required') ? 'border-red-600' : 'border-gray-300'"
                                        class="mt-0.5 rounded-md border dark:border-gray-500 shadow-sm overflow-hidden">
                                        <!-- Header -->
                                        <div class="flex items-center -my-px py-0.5 px-3 h-11">
                                            <div class="flex items-center flex-auto min-w-0">
                                                <mat-icon
                                                    class="icon-size-5"
                                                    [svgIcon]="'heroicons_solid:search'"></mat-icon>
                                                <input
                                                    class="min-w-0 ml-2 py-1 border-0"
                                                    type="text"
                                                    placeholder="Enter Category name"
                                                    (input)="filterCategories($event)"
                                                    (keydown)="filterCategoriesInputKeyDown($event)"
                                                    [maxLength]="20"
                                                    #newCategoryInput>
                                            </div>
                                            <!-- <input
                                                id="category-edit-button"
                                                class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                type="button"
                                                (click)="toggleCategoriesEditMode()"
                                                mat-icon-button>
                                            
                                            <label 
                                                class="flex items-center justify-center w-10 h-10 rounded-full cursor-pointer hover:bg-hover"
                                                for="category-edit-button"
                                                matRipple>
                                                <mat-icon
                                                    *ngIf="!productCategoriesEditMode"
                                                    class="icon-size-5"
                                                    [svgIcon]="'heroicons_solid:pencil-alt'"></mat-icon>
                                                <mat-icon
                                                    *ngIf="productCategoriesEditMode"
                                                    class="icon-size-5"
                                                    [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                            </label> -->
                                        </div>
                                        <!-- Available categories -->
                                        <div class="h-[94px] leading-none overflow-y-auto border-t border-gray-300 dark:border-gray-500">
                                            <!-- Categories -->
                                            <ng-container *ngIf="!productCategoriesEditMode">
                                                <ng-container *ngFor="let category of filteredProductCategories; trackBy: trackByFn;">
                                                    <mat-checkbox
                                                        class="flex items-center h-9 min-h-9 px-4"
                                                        [color]="'primary'"
                                                        [checked]="addProductForm.get('step1').get('categoryId').value && addProductForm.get('step1').get('categoryId').value.includes(category.id)"
                                                        (change)="toggleProductCategory(category, $event);"
                                                    >
                                                        {{category.name}}
                                                    </mat-checkbox>
                                                </ng-container>
                                            </ng-container>
                                            <!-- Categories editing -->
                                            <ng-container *ngIf="productCategoriesEditMode">
                                                <div class="p-4 space-y-1">
                                                    <ng-container *ngFor="let category of filteredProductCategories; trackBy: trackByFn;">
                                                        <mat-form-field class="fuse-mat-dense fuse-mat-no-subscript w-full">
                                                            <input
                                                                matInput
                                                                [id]="'category-input-' + category.id"
                                                                [value]="category.name"
                                                                [readonly]="!productCategoriesValueEditMode[i]"
                                                                (input)="updateLocalCategoryTitle(category, $event)"
                                                            >
                                                            <input
                                                                [id]="'category-edit-' + category.id"
                                                                type="button"
                                                                (click)="productCategoriesValueEditMode[i] = !productCategoriesValueEditMode[i]"
                                                                class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                                mat-button>
                                                            <label 
                                                                *ngIf="!productCategoriesValueEditMode[i]"
                                                                class="flex items-center justify-center p-2 rounded-full cursor-pointer hover:bg-hover"
                                                                [for]="'category-edit-' + category.id"
                                                                matRipple>
                                                                <mat-icon
                                                                    class="icon-size-5"
                                                                    [svgIcon]="'heroicons_solid:pencil-alt'"></mat-icon>
                                                            </label>
                                                            <input
                                                                [id]="'category-add-' + category.id"
                                                                type="button"
                                                                (click)="productCategoriesValueEditMode[i] = !productCategoriesValueEditMode[i]; updateServerCategoryTitle(category, $event)"
                                                                class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                                mat-button>
                                                            <label 
                                                                *ngIf="productCategoriesValueEditMode[i]"
                                                                class="flex items-center justify-center p-2 rounded-full cursor-pointer hover:bg-hover"
                                                                [for]="'category-add-' + category.id"
                                                                matRipple>
                                                                <mat-icon
                                                                    class="icon-size-5"
                                                                    [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                                            </label>
                                                            <input
                                                                [id]="'category-remove-' + category.id"
                                                                type="button"
                                                                (click)="deleteCategory(category)"
                                                                class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                                mat-button>
                                                            <label 
                                                                class="flex items-center justify-center p-2 rounded-full cursor-pointer hover:bg-hover"
                                                                [for]="'category-remove-' + category.id"
                                                                matRipple>
                                                                <mat-icon
                                                                    class="icon-size-5"
                                                                    [svgIcon]="'heroicons_solid:trash'"></mat-icon>
                                                            </label>
                                                        </mat-form-field>
                                                    </ng-container>
                                                </div>
                                            </ng-container>
                                            <!-- <div
                                                class="flex items-center h-8 min-h-8 -ml-0.5 pl-4 pr-3 leading-none cursor-pointer border-t hover:bg-gray-50 dark:hover:bg-hover"
                                                *ngIf="shouldShowCreateCategoryButton(newCategoryInput.value)"
                                                (click)="createCategory(newCategoryInput.value); newCategoryInput.value = ''"
                                                matRipple>
                                                <mat-icon
                                                    class="mr-2 icon-size-5"
                                                    [svgIcon]="'heroicons_solid:plus-circle'"></mat-icon>
                                                <div class="break-all">Create "<b>{{newCategoryInput.value}}</b>"</div>
                                            </div> -->
                                        </div>
                                    </div>
                                    <mat-error 
                                    class="text-sm font-medium" 
                                    [ngClass]="addProductForm.get('step1').get('categoryId').hasError('required') ? 'visible' : 'invisible'">
                                        Required
                                    </mat-error>
                                </div>
                                <!-- Bulk Item, Vehicle Type  -->
                                <div class="w-full pt-0 flex flex-row justify-between">
                                    <!-- Bulk Item  -->
                                    <div class="flex flex-col lg:mb-4">
                                        <span class="mb-2 sm:mb-2 font-medium leading-tight">Bulk Item 
                                            <mat-icon
                                                matTooltip="Is this product a bulk item?"
                                                class="transform scale-75"
                                                [svgIcon]="'heroicons_solid:question-mark-circle'">
                                            </mat-icon>
                                        </span>
                                        <div class="mt-0 flex items-center justify-between -my-px w-full">
                                            <mat-slide-toggle
                                                [formControlName]="'isBulkItem'"
                                                [color]="'primary'"
                                                (change)="( (addProductForm.get('step1').get('isBulkItem').value === true) ) ? addProductForm.get('step1').get('vehicleType').setValue('CAR') : ''"
                                                >
                                                {{addProductForm.get('step1').get('isBulkItem').value === true ? 'Yes' : 'No'}}
                                            </mat-slide-toggle>
                                            <!-- *ngIf="selectedProductForm.get('isVariants').value === true" -->
                                        </div>
                                    </div>
                                    <!-- Vehicle Type  -->
                                    <div *ngIf="addProductForm.get('step1').get('isBulkItem').value === true">
                                        <mat-form-field 
                                            class="w-full"
                                            appearance="fill" floatLabel="always"
                                            >
                                            <mat-label>Vehicle Type</mat-label>
                                            <mat-select
                                                class="w-full"
                                                appearance="fill"
                                                [formControlName]="'vehicleType'"
                                                placeholder="Select one option"
                                                (selectionChange)="addProductForm.get('step1').get('vehicleType').patchValue(vehicleTypeSelector.value)"
                                                #vehicleTypeSelector="matSelect"
                                                >
                                                <mat-select-trigger>
                                                    <span class="flex items-center">
                                                        <span>{{ vehicleTypeSelector.triggerValue }}</span>
                                                    </span>
                                                </mat-select-trigger>
                                                <div>
                                                    <mat-option *ngFor="let vehicle of deliveryVehicle" [value]="vehicle.vehicleType">{{vehicle.name}}</mat-option>
                                                </div>
                                            </mat-select>
                                            <mat-error *ngIf="addProductForm.get('step1').get('vehicleType').hasError('required')">
                                                Required
                                            </mat-error>
                                        </mat-form-field>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Available stock -->
                        <div 
                            *ngIf="store$.verticalCode === 'E-Commerce' || store$.verticalCode === 'ECommerce_PK' || store$.verticalCode === 'e-commerce-b2b2c'"
                            class="flex flex-col sm:flex-row flex-wrap py-1 border-t px-2">
                            <div class="flex flex-auto flex-wrap">
                                <!-- Available stock row -->
                                <div class="flex flex-col w-full sm:w-1/5 sm:pr-2 sm:border-r py-2 sm:py-0">
                                    <span class="mb-2 font-medium leading-tight">Available Stock
                                        <mat-icon
                                            matTooltip="Current available stock"
                                            class="transform scale-75"
                                            [svgIcon]="'heroicons_solid:question-mark-circle'">
                                        </mat-icon>
                                    </span>
                                    <mat-form-field 
                                        class="mt-0 sm:mt-1 flex items-center -my-px w-full"
                                        appearance="fill" floatLabel="always"
                                    >
                                        <input
                                            (input)="(addProductForm.get('step1').get('availableStock').value > 0 && addProductForm.get('step1').get('status').value === 'OUTOFSTOCK') ? 
                                                addProductForm.get('step1').get('status').patchValue('ACTIVE') : ''"
                                            (input)="(addProductForm.get('step1').get('availableStock').value === 0) ? 
                                                addProductForm.get('step1').get('status').patchValue('OUTOFSTOCK') : ''"
                                            placeholder="Insert current stock"
                                            [formControlName]="'availableStock'"
                                            type="number"
                                            required
                                            matInput
                                        >
                                        <mat-error *ngIf="addProductForm.get('step1').get('availableStock').hasError('required')">
                                            Required
                                        </mat-error>
                                    </mat-form-field>
                                </div>
                                <!-- Track Stock Level -->
                                <div class="flex flex-col w-full sm:w-1/5 sm:px-2 sm:border-r py-2 sm:py-0">
                                    <span class="mb-2 font-medium leading-tight">Track Stock Level
                                        <mat-icon
                                            matTooltip="Keep track the quantity of the stock"
                                            class="transform scale-75"
                                            [svgIcon]="'heroicons_solid:question-mark-circle'">
                                        </mat-icon>
                                    </span>
                                    <div class="mt-0 flex items-center -my-px w-full">
                                        <mat-slide-toggle
                                            [formControlName]="'trackQuantity'"
                                            [color]="'primary'"
                                            (change)="disabledTrackStock($event.checked)"
                                            >
                                            {{addProductForm.get('step1').get('trackQuantity').value === true ? 'Active' : 'Disabled'}}
                                        </mat-slide-toggle>
                                    </div>
                                </div>
                                <!-- Out of Stock Selling -->
                                <div class="flex flex-col w-full sm:w-1/5 sm:px-2 sm:border-r py-2 sm:py-0">
                                    <span class="mb-2 font-medium leading-tight">Out-of-stock Sales
                                        <mat-icon
                                            matTooltip="Continue selling even when out of stock"
                                            class="transform scale-75 mr-4"
                                            [svgIcon]="'heroicons_solid:question-mark-circle'">
                                        </mat-icon>
                                    </span>
                                    <div class="mt-0 sm:mt-0 flex items-center -my-px w-full">
                                        <mat-slide-toggle
                                            [disabled]="addProductForm.get('step1').get('trackQuantity').value === false"
                                            [formControlName]="'allowOutOfStockPurchases'"
                                            [color]="'primary'">
                                            {{addProductForm.get('step1').get('allowOutOfStockPurchases').value === true ? 'Yes' : 'No'}}
                                        </mat-slide-toggle>
                                    </div>
                                </div>
                                <!-- Low Stock Alarm -->
                                <div class="flex flex-col w-full sm:w-1/5 sm:px-2 sm:border-r py-2 sm:py-0">
                                    <span class="mb-2 font-medium leading-tight">Low Stock Alarm
                                        <mat-icon
                                            matTooltip="Minimum 0 value to activate the alarm. Input negative value to disable the alarm"
                                            class="transform scale-75"
                                            [svgIcon]="'heroicons_solid:question-mark-circle'">
                                        </mat-icon>
                                    </span>
                                    <div *ngIf="addProductForm.get('step1').get('minQuantityForAlarm').value < 0" class="mt-0 sm:mt-0 flex items-center -my-px w-full">
                                        <mat-slide-toggle
                                            [color]="'primary'"
                                            [disabled]="addProductForm.get('step1').get('trackQuantity').value === false"
                                            (click)="addProductForm.get('step1').get('minQuantityForAlarm').value = 0"
                                            >
                                            {{addProductForm.get('step1').get('minQuantityForAlarm').value >= 0 ? 'Active' : 'Disabled'}}
                                        </mat-slide-toggle>
                                    </div>
                                    <mat-form-field *ngIf="addProductForm.get('step1').get('minQuantityForAlarm').value >= 0" class="mt-0 sm:mt-1 flex items-center -my-px w-full">
                                        <input
                                            type="number"
                                            matInput
                                            [formControlName]="'minQuantityForAlarm'">
                                    </mat-form-field>
                                </div>
                                <!-- Variants Toggle -->
                                <div 
                                    *ngIf="productType === 'normal'"
                                    class="flex flex-col w-full sm:w-1/5 sm:pl-2 py-2 sm:py-0"
                                >
                                    <span class="mb-2 font-medium leading-tight">Variants 
                                        <mat-icon
                                            matTooltip="Does this product have variants?"
                                            class="transform scale-75"
                                            [svgIcon]="'heroicons_solid:question-mark-circle'">
                                        </mat-icon>
                                    </span>
                                    <div class="mt-0 flex items-center justify-between -my-px w-full">
                                        <mat-slide-toggle
                                            [formControlName]="'isVariants'"
                                            [color]="'primary'"
                                            >
                                            {{addProductForm.get('step1').get('isVariants').value === true ? 'Yes' : 'No'}}
                                        </mat-slide-toggle>
                                        <!-- *ngIf="selectedProductForm.get('isVariants').value === true" -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Special notes  -->
                        <div class="flex flex-col flex-wrap py-1 border-t px-2 w-full">
                            <!-- Special notes slider and button & field -->
                            <div class="w-full sm:w-1/2 py-2 flex flex-row justify-between">
                                <!-- Slider and radio button  -->
                                <div class="flex flex-col">
                                    <span class="mb-2 sm:mb-2 font-medium leading-tight">Customise Special Instruction
                                        <mat-icon
                                            matTooltip="Do you want to customise the special instruction?"
                                            class="transform scale-75"
                                            [svgIcon]="'heroicons_solid:question-mark-circle'">
                                        </mat-icon>
                                    </span>
                                    <!-- Slider and radio button  -->
                                    <div class="mt-0 flex items-center justify-between w-full">
                                        <!-- Slider  -->
                                        <mat-slide-toggle
                                            [formControlName]="'isCustomNote'"
                                            [color]="'primary'"
                                            class="pr-2"
                                            (change)="( addProductForm.get('step1').get('isCustomNote').value === true ) ? addProductForm.get('step1').get('isNoteOptional').setValue(true) 
                                                : addProductForm.get('step1').get('customNote').setValue(null); addProductForm.get('step1').get('isNoteOptional').setValue(true)"
                                            >
                                            {{addProductForm.get('step1').get('isCustomNote').value === true ? 'Yes' : 'No'}}
                                        </mat-slide-toggle>
                                        <!-- *ngIf="selectedProductForm.get('isVariants').value === true" -->
                                        <!-- Radio button  -->
                                        <div *ngIf="addProductForm.get('step1').get('isCustomNote').value === true" class="pl-6">
                                            <mat-radio-group
                                                class="flex flex-row"
                                                [color]="'primary'"
                                                [formControlName]="'isNoteOptional'">
                                                <mat-radio-button
                                                    class="ml-2"
                                                    [value]="true">
                                                    Optional
                                                </mat-radio-button>
                                                <mat-radio-button
                                                    class="ml-4"
                                                    [value]="false">
                                                    Mandatory
                                                </mat-radio-button>
                                            </mat-radio-group>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Custom note field  -->
                            <div *ngIf="addProductForm.get('step1').get('isCustomNote').value === true">
                                <mat-form-field class="w-full lg:w-1/2 pt-2" floatLabel="always">
                                    <textarea
                                        matInput
                                        [formControlName]="'customNote'"
                                        placeholder="Insert the custom special instruction (not more than 100 characters)"
                                        [rows]="full"
                                        maxlength="100"
                                        class="h-8"
                                        autocomplete="disabled"
                                        matTextareaAutosize></textarea>
                                </mat-form-field>
                            </div>
                        </div>
                        
                    </div>
                    <!-- Cancel, Next button -->
                    <div class="flex justify-end mt-3">
                        <!-- Flash message -->
                        <div
                            class="flex items-center mr-4"
                            *ngIf="flashMessage">
                            <ng-container *ngIf="flashMessage === 'success'">
                                <mat-icon
                                    class="text-green-500"
                                    [svgIcon]="'heroicons_outline:check'"></mat-icon>
                                <span class="ml-2">Product created</span>
                            </ng-container>
                            <ng-container *ngIf="flashMessage === 'error'">
                                <mat-icon
                                    class="text-red-500"
                                    [svgIcon]="'heroicons_outline:x'"></mat-icon>
                                <span class="ml-2">An error occurred, try again!</span>
                            </ng-container>
                        </div>
                        <!-- Cancel button -->
                        <button
                            mat-flat-button
                            class="sm:w-24 mr-2 bg-gray-300 hover:bg-gray-500 border border-gray-500"
                            [color]="'gray'"
                            (click)="cancelAddProduct()"
                            >
                            <mat-icon
                                    *ngIf="!currentScreenSize.includes('sm')"
                                    class="text-white icon-size-5"
                                    [svgIcon]="'heroicons_outline:x'">
                            </mat-icon>
                            <span class="hidden sm:block justify-center">
                                Cancel
                            </span>
                        </button>
                        
                            
                        <!-- Next variant button -->
                        <button
                            *ngIf="addProductForm.get('step1').get('isVariants').value === true"
                            class="sm:w-24"
                            mat-flat-button
                            [color]="'primary'"
                            [disabled]="horizontalStepperStep1.stepControl.pristine || horizontalStepperStep1.stepControl.invalid"
                            type="button"
                            (click)="!newProductId && addNewProductMethod()"
                            matStepperNext>
                            <mat-icon
                                    *ngIf="!currentScreenSize.includes('sm')"
                                    class="text-white icon-size-5"
                                    [svgIcon]="'heroicons_outline:chevron-right'">
                            </mat-icon>
                            <span class="hidden sm:block justify-center">
                                Next
                            </span>
                        </button>
                        <!-- Next combo button -->
                        <button
                            *ngIf="productType === 'combo'"
                            class="sm:w-24"
                            mat-flat-button
                            [color]="'primary'"
                            [disabled]="horizontalStepperStep1.stepControl.pristine || horizontalStepperStep1.stepControl.invalid"
                            type="button"
                            (click)="!newProductId && addNewProductMethod()"
                            matStepperNext>
                            <mat-icon
                                    *ngIf="!currentScreenSize.includes('sm')"
                                    class="text-white icon-size-5"
                                    [svgIcon]="'heroicons_outline:chevron-right'">
                            </mat-icon>
                            <span class="hidden sm:block justify-center">
                                Next
                            </span>
                        </button>
                        <!-- Create button -->
                        <button
                            *ngIf="addProductForm.get('step1').get('isVariants').value === false && productType != 'combo'"
                            class="sm:w-24"
                            mat-flat-button
                            [color]="'primary'"
                            [disabled]="isLoading || horizontalStepperStep1.stepControl.pristine || horizontalStepperStep1.stepControl.invalid"
                            type="button"
                            (click)="addNewProductMethod()"
                            matStepperNext>
                            <mat-icon
                                    *ngIf="!currentScreenSize.includes('sm')"
                                    class="text-white icon-size-5"
                                    [svgIcon]="'heroicons_outline:check'">
                            </mat-icon>
                            <span class="hidden sm:block justify-center">
                                Create
                            </span>
                        </button>
                    </div>
                </mat-step>

                <!-- Variant section -->
                <mat-step
                    *ngIf="addProductForm.get('step1').get('isVariants').value === true"
                    [formGroupName]="'variantsSection'"
                    [stepControl]="addProductForm.get('variantsSection')"
                    #horizontalStepperVariantStep>
                    <ng-template 
                        matStepLabel>Variants</ng-template>
                    <!-- <p class="my-6 font-medium">
                        Please add variants for this product
                    </p> -->
                    <!-- Content -->
                    <div class="content overflow-y-auto sm:overflow-hidden mx-2 flex flex-auto flex-wrap">
                        <!-- Variant Control and Table -->
                        <div class="flex flex-auto flex-wrap w-full">
                            <!-- Variants/Options Control-->
                            <div class="flex flex-col w-full sm:w-1/4">
                                <!-- Variant -->
                                <div class="w-full mb-3">
                                    <span class="mb-px font-medium leading-tight">Variant</span>
                                    <div class="mt-1 rounded-md border border-gray-300 dark:border-gray-500 shadow-sm overflow-hidden">
                                        <!-- Header -->
                                        <div class="flex items-center -my-px py-3 px-3">
                                            <div class="flex items-center flex-auto min-w-0">
                                                <mat-icon
                                                    class="icon-size-5"
                                                    [svgIcon]="'heroicons_solid:search'"></mat-icon>
                                                <input
                                                    class="min-w-0 ml-2 py-1 border-0"
                                                    type="text"
                                                    placeholder="Enter variant name"
                                                    (input)="filterVariants($event)"
                                                    (keydown)="filterVariantsInputKeyDown($event)"
                                                    [maxLength]="50"
                                                    #newVariantInput>
                                            </div>
                                        </div>
                                        <!-- List of variants -->
                                        <div class="h-42 leading-none overflow-y-auto border-t border-gray-300 dark:border-gray-500">
                                            <!-- Variants -->
                                            <ng-container>
                                                <div class="flex flex-col p-4 min-h-30 h-30 mb-0 space-y-2">
                                                    <ng-container *ngIf="filteredProductVariants.length; else productVariantsBlank">
                                                        <ng-container *ngFor="let variant of filteredProductVariants; let i = index; trackBy: trackByFn">
                                                            <mat-form-field class="fuse-mat-dense fuse-mat-no-subscript w-full">
                                                                <input
                                                                    matInput
                                                                    [value]="variant.name"
                                                                    readonly
                                                                    >
                                                                <!-- <button
                                                                    *ngIf="!productVariantsValueEditMode[i]"
                                                                    mat-icon-button
                                                                    (click)="productVariantsValueEditMode[i] = !productVariantsValueEditMode[i]"
                                                                    matSuffix>
                                                                    <mat-icon
                                                                        class="icon-size-5"
                                                                        [svgIcon]="'heroicons_solid:pencil-alt'"></mat-icon>
                                                                </button>
                                                                <button
                                                                    *ngIf="productVariantsValueEditMode[i]"
                                                                    mat-icon-button
                                                                    (click)="productVariantsValueEditMode[i] = !productVariantsValueEditMode[i];updateVariantTitle(variant.id);"
                                                                    matSuffix>
                                                                    <mat-icon
                                                                        class="icon-size-5"
                                                                        [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                                                </button> -->
                                                                <button
                                                                    mat-icon-button
                                                                    (click)="deleteVariantMethod(variant, i)"
                                                                    matSuffix>
                                                                    <mat-icon
                                                                        class="icon-size-5"
                                                                        [svgIcon]="'heroicons_solid:trash'"></mat-icon>
                                                                </button>
                                                            </mat-form-field>
                                                        </ng-container>
                                                    </ng-container>
                                                    <ng-template #productVariantsBlank>
                                                        <div class="h-full">&nbsp;</div>
                                                    </ng-template>
                                                </div>
                                            </ng-container>
                                            <div
                                                class="flex items-center h-10 min-h-10 -ml-0.5 pl-4 pr-3 leading-none cursor-pointer border-t hover:bg-gray-50 dark:hover:bg-hover"
                                                *ngIf="shouldShowCreateVariantButton(newVariantInput.value) && filteredProductVariants.length < 2"
                                                (click)="createVariantMethod(newVariantInput.value); newVariantInput.value = ''"
                                                matRipple>
                                                <mat-icon
                                                    class="mr-2 icon-size-5"
                                                    [svgIcon]="'heroicons_solid:plus-circle'"></mat-icon>
                                                <div class="break-all">Create "<b>{{newVariantInput.value}}</b>"</div>
                                            </div>
                                            <div
                                                class="flex items-center h-10 min-h-10 -ml-0.5 pl-4 pr-3 leading-none cursor-default border-t hover:bg-gray-50 dark:hover:bg-hover"
                                                *ngIf="filteredProductVariants.length >= 2"
                                            >
                                                <mat-icon
                                                    class="mr-2 icon-size-5"
                                                    [svgIcon]="'heroicons_outline:exclamation-circle'"></mat-icon>
                                                <div class="text-sm md:text-xs">You can only create maximum of 2 variants</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Variant Options -->
                                <div class="w-full max-w-2xl">
                                    <span class="mt-2 mb-px font-medium leading-tight">Variant Options</span>
                                    <div class="w-full mt-1 rounded-md border border-gray-300 dark:border-gray-500 shadow-sm overflow-auto">
                                        <!-- Variants Available -->
                                        <div class="h-34 min-h-8 m-2 leading-none overflow-y-auto border-gray-300 dark:border-gray-500">
                                            <div *ngIf="filteredProductVariants.length > 0">
                                                <div *ngFor="let variant of filteredProductVariants; let i = index; trackBy: trackVariant">
                                                    <span class="w-full mb-px font-small leading-tight">{{variant.name}}</span>
                                                    <div class="flex items-center rounded-full w-full">
                                                        <div class="ml-0 m-1.5">
                                                            <span class="text-md font-small whitespace-nowrap flex items-center justify-center">
                                                                <input
                                                                    [id]="'variant-available-edit-button-' + variant.name"
                                                                    class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                                    type="button"
                                                                    (click)="openVariantsPanel(variant, i)"
                                                                    mat-icon-button
                                                                    #variantsPanelOrigin>
                                                                <label 
                                                                    class="flex items-center justify-center p-3 h-7 w-7 cursor-pointer rounded-full leading-9 bg-primary"
                                                                    [for]="'variant-available-edit-button-' + variant.name"
                                                                    matRipple>
                                                                    <mat-icon
                                                                        [svgIcon]="'heroicons_outline:plus'"
                                                                        class="text-white icon-size-5"></mat-icon>
                                                                </label>
                                                            </span>
                                                        </div>
                                                        <!-- <span>{{variant.productVariantsAvailable}}</span> -->
                                                        <div *ngFor="let variantsAvailable of variant.productVariantsAvailable; trackBy: trackVariantAvailable" class="px-2 ml-0 m-1 rounded-full leading-7 text-gray-500 bg-gray-300 dark:text-gray-300 dark:bg-gray-700">
                                                            <span class="text-md font-small whitespace-nowrap flex items-center justify-center">
                                                                <span class="ml-0.5 text-md font-medium whitespace-nowrap">{{variantsAvailable.value}}</span>
                                                            </span>
                                                        </div>
                                                        <!-- <div *ngFor="let variantsAvailable of variant.productVariantsAvailable; trackBy: trackByFn">
                                                            <span class="text-md font-small whitespace-nowrap flex items-center justify-center comma-list">
                                                                <span class="ml-1 text-md font-medium whitespace-nowrap">{{variantsAvailable.value}}</span>
                                                            </span>
                                                        </div> -->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- Variants panel and its button -->
                                        <div>
                                            <!-- Variants panel -->
                                            <ng-template #variantsPanel>
                                                <div class="w-60 rounded border shadow-md bg-card">
                                                    <!-- Variants panel header -->
                                                    <div class="flex items-center m-3 mr-2">
                                                        <div class="flex items-center">
                                                            <mat-icon
                                                                class="icon-size-5"
                                                                [svgIcon]="'heroicons_solid:search'"></mat-icon>
                                                            <div class="ml-2">
                                                                <input
                                                                    class="w-full min-w-0 py-1 border-0"
                                                                    type="text"
                                                                    placeholder="Enter variant option"
                                                                    (input)="filterProductVariantAvailable($event)"
                                                                    (keydown)="filterProductVariantAvailableInputKeyDown($event)"
                                                                    [maxLength]="30"
                                                                    #newVariantAvailableInput>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div
                                                        class="flex flex-col max-h-70 py-2 border-t">
                                                        <!-- Variant Available -->
                                                        <ng-container *ngIf="!productVariantAvailableEditMode">
                                                            <div class="pt-2 space-y-2">
                                                                <div class="overflow-y-auto space-y-2 max-h-48">
                                                                    <ng-container *ngFor="let variantAvailable of filteredProductVariantAvailable; let i = index; trackBy: trackByFn">
                                                                        <div class="flex items-center">
                                                                            <mat-form-field class="fuse-mat-dense fuse-mat-no-subscript w-full mx-4">
                                                                                <input
                                                                                    matInput 
                                                                                    [value]="variantAvailable.value"
                                                                                    (input)="editVariantAvailableTitleMethod(variant, $event)"
                                                                                    [readonly]="!productVariantAvailableValueEditMode[i]"
                                                                                >
                                                                                <!-- <button
                                                                                    mat-icon-button
                                                                                    *ngIf="productVariantAvailableValueEditMode[i]"
                                                                                    (click)="productVariantAvailableValueEditMode[i] = !productVariantAvailableValueEditMode[i]; updateVariantAvailableTitle(variant, $event)"
                                                                                    matSuffix>
                                                                                    <mat-icon
                                                                                        class="icon-size-5 ml-2"
                                                                                        [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                                                                </button>
                                                                                <button
                                                                                    mat-icon-button
                                                                                    *ngIf="!productVariantAvailableValueEditMode[i]"
                                                                                    (click)="productVariantAvailableValueEditMode[i] = !productVariantAvailableValueEditMode[i]"
                                                                                    matSuffix>
                                                                                    <mat-icon
                                                                                        class="icon-size-5 ml-2"
                                                                                        [svgIcon]="'heroicons_solid:pencil-alt'"></mat-icon>
                                                                                </button> -->
                                                                                <button
                                                                                    mat-icon-button
                                                                                    (click)="deleteVariantAvailableMethod(variantAvailable, variantIndex)"
                                                                                    matSuffix>
                                                                                    <mat-icon
                                                                                        class="icon-size-5 ml-2"
                                                                                        [svgIcon]="'heroicons_solid:trash'"></mat-icon>
                                                                                </button>
                                                                            </mat-form-field>
                                                                        </div>
                                                                    </ng-container>
                                                                </div>
                                                                <!-- <div class="flex items-center h-14 sm:h-12 min-h-10 -ml-0.5 pl-4 pr-3 leading-none">
                                                                    <mat-icon
                                                                        class="mr-2 icon-size-5"
                                                                        [svgIcon]="'heroicons_outline:exclamation-circle'"></mat-icon>
                                                                    <span class="text-sm md:text-xs">
                                                                        Adding/deleting variant option will reset the variant list values
                                                                    </span>
                                                                </div> -->
                                                            </div>
                                                        </ng-container>
                                                        <!-- Create variant options-->
                                                        <div
                                                            class="flex items-center h-10 min-h-10 -ml-0.5 pl-4 pr-3 leading-none cursor-pointer hover:bg-hover"
                                                            *ngIf="shouldShowCreateVariantAvailableButton(newVariantAvailableInput.value) && productVariantAvailable.length < 10"
                                                            (click)="createVariantAvailableMethod(newVariantAvailableInput.value, variantIndex); newVariantAvailableInput.value = ''"
                                                            matRipple>
                                                            <mat-icon 
                                                                class="mr-2 icon-size-5"
                                                                [svgIcon]="'heroicons_solid:plus-circle'"></mat-icon>
                                                            <div class="break-all">Create "<b>{{newVariantAvailableInput.value}}</b>"</div>
                                                        </div>
                                                        <div
                                                            class="flex items-center h-12 sm:h-10 min-h-10 -ml-0.5 pl-4 pr-3 leading-none cursor-default border-t hover:bg-gray-50 dark:hover:bg-hover"
                                                            *ngIf="productVariantAvailable?.length >= 10"
                                                        >
                                                            <mat-icon
                                                                class="mr-2 icon-size-5"
                                                                [svgIcon]="'heroicons_outline:exclamation-circle'"></mat-icon>
                                                            <div class="text-sm md:text-xs">You can only create maximum of 10 variant options</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </ng-template>
                                        </div>
                                        
                                    </div>
                                </div>
                            </div>
                            <!-- Variant Details Table -->
                            <div class="flex flex-col w-full sm:w-3/4 sm:px-4 py-4 sm:py-0">
                                <div class="flex flex-col sm:flex-row justify-between">
                                    <div class="font-medium tracking-tight mb-1 truncate">Variant Details</div>
                                    <div 
                                        *ngIf="this.variantAvailableToBeCreated.length > 0" 
                                        class="flex flex-row px-1 items-center"
                                        >
                                        <mat-icon
                                            class="mr-2 icon-size-5 text-amber-500"
                                            [svgIcon]="'heroicons_solid:exclamation'"></mat-icon>
                                        <span class="font-medium text-sm text-amber-500">
                                            The list has been updated. Please confirm the values!
                                        </span>
                                    </div>
                                </div>
                                <div class="flex flex-auto overflow-x-auto">
                                    <div class="flex flex-col flex-auto sm:mb-18">
                                        <ng-container>
                                            <ng-container>
                                                <div class="grid overflow-x-auto">
                                                    <!-- Header -->
                                                    <div
                                                        class="variant-grid z-9 sticky top-0 grid gap-4 py-4 px-3 md:px-3 shadow text-md font-semibold text-secondary bg-gray-50 dark:bg-black dark:bg-opacity-5"
                                                        matSort
                                                        matSortDisableClear>
                                                        <div>
                                                            <!-- Image -->
                                                        </div>
                                                        <div
                                                            [mat-sort-header]="'sku'">
                                                            SKU
                                                        </div>
                                                        <div 
                                                            [mat-sort-header]="'vname'">
                                                            Name
                                                        </div>
                                                        <div
                                                            [mat-sort-header]="'price'">
                                                            Price
                                                        </div>
                                                        <div
                                                            [mat-sort-header]="'quantity'">
                                                            Stock
                                                        </div>
                                                        <!-- <div
                                                            class="hidden lg:block"
                                                            [mat-sort-header]="'active'">
                                                            Publish
                                                        </div> -->
                                                        <!-- <div>
                                                            Variant Status
                                                        </div> -->
                                                    </div>
                                                    <!-- Rows -->
                                                    <div 
                                                        class="variant-details-grid overflow-y-auto"
                                                        *ngIf="selectedVariantCombos">
                                                        <div *ngFor="let variantCombo of selectedVariantCombos; let i = index; trackBy: trackByFn">
                                                            <!-- Variant Header -->
                                                            <div class="variant-grid grid items-center gap-4 py-3 px-3 md:px-3 border-b">      
                                                                <!-- Image -->
                                                                <div  class="flex items-center">
                                                                    <div>
                                                                        <div>
                                                                            <input
                                                                                [id]="'image-add-input-variant' + variantCombo.variant"
                                                                                class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                                                type="file"
                                                                                [multiple]="false"
                                                                                [accept]="'image/jpeg, image/png'"
                                                                                (change)="uploadVariantImagesMethod(imageFileInput.files, [], i);"
                                                                                #imageFileInput>
                                                                            <label
                                                                                class="flex items-center justify-center w-6 h-6 rounded-full cursor-pointer hover:bg-hover"
                                                                                [matTooltip]="variantCombo.image.preview ? 'Change image' : 'Add image'"
                                                                                [for]="'image-add-input-variant' + variantCombo.variant"
                                                                                matRipple>
                                                                                <mat-icon
                                                                                    class="icon-size-3"
                                                                                    [svgIcon]="variantCombo.image.preview ? 'heroicons_solid:pencil-alt' : 'heroicons_outline:plus-circle'"></mat-icon>
                                                                            </label>
                                                                        </div>
                                                                        <!-- Remove Image -->
                                                                        <div *ngIf="variantCombo.image.preview">
                                                                            <input
                                                                                [id]="'image-remove-button-variant'+ variantCombo.variant"
                                                                                class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                                                type="button"
                                                                                (click)="removeVariantImageMethod(i)"
                                                                                mat-icon-button>
                                                                            <label 
                                                                                class="flex items-center justify-center w-6 h-6 rounded-full cursor-pointer hover:bg-hover"
                                                                                [for]="'image-remove-button-variant'+ variantCombo.variant"
                                                                                matTooltip="Remove image"
                                                                                matRipple>
                                                                                <mat-icon
                                                                                    class="icon-size-3"
                                                                                    [svgIcon]="'heroicons_outline:trash'"></mat-icon>
                                                                            </label>
                                                                        </div>
                                                                        <!-- Set Thumbnail -->
                                                                        <div *ngIf="variantCombo.image.preview">
                                                                            <input
                                                                                [id]="'new-set-thumbnail-button'+ variantCombo.variant"
                                                                                class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                                                type="button"
                                                                                (click)="setThumbnail(i, true)"
                                                                                mat-icon-button>
                                                                            <label 
                                                                                class="flex items-center justify-center w-6 h-6 rounded-full cursor-pointer hover:bg-hover"
                                                                                [for]="'new-set-thumbnail-button'+ variantCombo.variant"
                                                                                [matTooltip]="!variantCombo.image.isThumbnail ? 'Set thumbnail' : ''"
                                                                                matRipple>
                                                                                <mat-icon
                                                                                    class="icon-size-3"
                                                                                    [svgIcon]="variantCombo.image.isThumbnail ? 'heroicons_solid:star' : 'heroicons_outline:star'"></mat-icon>
                                                                            </label>
                                                                        </div>
                                                                    </div>
                                                                    <div class="relative flex flex-0 items-center justify-center w-12 h-12 rounded overflow-hidden border">
                                                                        <ng-container *ngIf="variantCombo.image.preview; else noImage">
                                                                            <img
                                                                                class="w-full h-full object-cover" 
                                                                                [src]="variantCombo.image.preview">
                                                                        </ng-container>
                                                                        <ng-template #noImage>
                                                                            <div
                                                                                class="flex items-center justify-center w-full h-full rounded overflow-hidden uppercase text-8xl font-bold leading-none bg-gray-200 text-gray-600 dark:bg-gray-700 dark:text-gray-200"
                                                                            >
                                                                                <span class="text-md">NO IMAGE</span> 
                                                                            </div>
                                                                        </ng-template>
                                                                    </div>
                                                                    
                                                                </div>                                 
                                                                <!-- SKU -->
                                                                <span class="truncate text-slate-400 font-light">
                                                                    {{variantCombo.sku}}
                                                                    <!-- <mat-form-field class="fuse-mat-dense fuse-mat-no-subscript w-full">
                                                                        <input
                                                                            type="text"
                                                                            readonly
                                                                            matInput
                                                                            (input)="variantSkuChanged($event,i)"
                                                                            [value]="variantCombo.sku">
                                                                    </mat-form-field> -->
                                                                </span>
                            
                                                                <!-- Name -->
                                                                <span class="truncate">
                                                                    {{variantCombo.variant}}
                                                                </span>

                            
                                                                <!-- Price -->
                                                                <div>
                                                                    <mat-form-field class="fuse-mat-dense fuse-mat-no-subscript w-full">
                                                                        <span matPrefix>{{store$.regionCountry.currencySymbol}}</span>
                                                                        <input
                                                                            matInput
                                                                            (input)="variantPriceChanged($event,i)"
                                                                            [value]="variantCombo.price"
                                                                            type="number">
                                                                    </mat-form-field> 
                                                                </div>
                            
                                                                <!-- Stock -->
                                                                <div>
                                                                    <mat-form-field class="fuse-mat-dense fuse-mat-no-subscript w-full">
                                                                        <input
                                                                            type="number"
                                                                            matInput
                                                                            (input)="variantStockChanged($event,i)"
                                                                            [value]="variantCombo.quantity">
                                                                    </mat-form-field>
                                                                </div>
                            
                                                                <!-- Publish -->
                                                                <!-- <div class="hidden lg:block">
                                                                    <ng-container *ngIf="variantCombo.active">
                                                                        <mat-icon
                                                                            class="text-green-400 icon-size-5"
                                                                            [svgIcon]="'heroicons_solid:check'"></mat-icon>
                                                                    </ng-container>
                                                                    <ng-container *ngIf="!variantCombo.active">
                                                                        <mat-icon
                                                                            class="text-gray-400 icon-size-5"
                                                                            [svgIcon]="'heroicons_solid:x'"></mat-icon>
                                                                    </ng-container>
                                                                </div> -->

                                                                <!-- Variant Status -->
                                                                <!-- <div>
                                                                    <mat-select
                                                                        class="border border-gray-300 px-2 py-2 rounded"
                                                                        [value]="variantCombo.status"
                                                                        (selectionChange)="variantCombo.status = $event.value"
                                                                        #statusSelector="matSelect"
                                                                        >
                                                                        <mat-select-trigger>
                                                                            <span class="flex items-center">
                                                                                <span>{{ statusSelector.triggerValue }}</span>
                                                                            </span>
                                                                        </mat-select-trigger>
                                                                        <div>
                                                                            
                                                                            <mat-option [value]="'AVAILABLE'">Available</mat-option>
                                                                            <mat-option [value]="'NOTAVAILABLE'">Not Available</mat-option>
                                                                        </div>
                                                                    </mat-select>
                                                                </div> -->
                                                                <!-- Details button -->
                                                                <!-- <div>
                                                                    <button
                                                                        class="min-w-10 min-h-7 h-7 px-2 leading-6"
                                                                        mat-stroked-button
                                                                        (click)="toggleVariantDetails(variantCombo.itemCode)">
                                                                        <mat-icon
                                                                            class="icon-size-5"
                                                                            [svgIcon]="selectedProductInventories?.itemCode === variantCombo.itemCode ? 'heroicons_solid:chevron-up' : 'heroicons_solid:chevron-down'"></mat-icon>
                                                                    </button>
                                                                </div> -->
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </ng-container>
                                        </ng-container>
                                        <ng-template #noVariants>
                                            <div class="p-8 sm:p-16 border-t text-2xl font-semibold tracking-tight text-center">There are no Variants! Add them now.</div>
                                        </ng-template>
                                    </div>
                                </div>
                                <!-- <button
                                mat-flat-button
                                [color]="'primary'"
                                (click)="createVariantCombinationsToBE()">
                                Preview Variant
                            </button> -->
                            </div>
                        </div>
                    </div>
                    <!-- Back, Next button -->
                    <div class="flex justify-end mt-3">
                        <!-- Flash message -->
                        <div
                            class="flex items-center mr-4"
                            *ngIf="flashMessage">
                            <ng-container *ngIf="flashMessage === 'success'">
                                <mat-icon
                                    class="text-green-500"
                                    [svgIcon]="'heroicons_outline:check'"></mat-icon>
                                <span class="ml-2">Product created</span>
                            </ng-container>
                            <ng-container *ngIf="flashMessage === 'error'">
                                <mat-icon
                                    class="text-red-500"
                                    [svgIcon]="'heroicons_outline:x'"></mat-icon>
                                <span class="ml-2">An error occurred, try again!</span>
                            </ng-container>
                        </div>
                        <!-- <button
                            class="px-8 mr-2"
                            mat-flat-button
                            [color]="'accent'"
                            type="button"
                            (click)="testMethod()">
                            Test
                        </button> -->
                        <!-- Back button  -->
                        <button
                            class="sm:px-8 mr-2 sm:w-24"
                            mat-flat-button
                            [color]="'accent'"
                            type="button"
                            matStepperPrevious>
                            <mat-icon
                                    *ngIf="!currentScreenSize.includes('sm')"
                                    class="text-white icon-size-5"
                                    [svgIcon]="'heroicons_outline:chevron-left'">
                            </mat-icon>
                            <span class="hidden sm:block justify-center">
                                Back
                            </span>
                        </button>
                        <!-- Create button -->
                        <button
                            class="sm:px-8 sm:w-24"
                            mat-flat-button
                            [color]="'primary'"
                            type="button"
                            (click)="postVariantMethod()"
                            matStepperNext>
                            <mat-icon
                                    *ngIf="!currentScreenSize.includes('sm')"
                                    class="text-white icon-size-5"
                                    [svgIcon]="'heroicons_outline:check'">
                            </mat-icon>
                            <span class="hidden sm:block justify-center">
                                Create
                            </span>
                        </button>
                    </div>
                </mat-step>

                <!-- Combo section -->
                <mat-step
                    *ngIf="productType === 'combo'"
                    [formGroupName]="'comboSection'"
                    [stepControl]="addProductForm.get('comboSection')"
                    #horizontalStepperComboStep>
                    <ng-template 
                        matStepLabel>Combo</ng-template>
                    <!-- <p class="my-6 font-medium">
                        Please add variants for this product
                    </p> -->
                    <!-- Content -->
                    <div class="content overflow-y-auto sm:overflow-hidden mx-2 flex flex-auto flex-wrap">
                        <!-- Variant Control and Table -->
                        <div class="flex flex-auto flex-wrap w-full">
                            <!-- Combo Control-->
                            <div class="flex flex-col w-full sm:w-1/4">
                                <!-- Option Name -->
                                <mat-form-field class="w-full">
                                    <mat-label>Option Name</mat-label>
                                    <input
                                        matInput
                                        [value]="(selectedProductsOption) ? selectedProductsOption.title : ''"
                                        (change)="validateProductsOptionName($event.target.value)"
                                        #optionName
                                    >
                                </mat-form-field>
                                <!-- Add product to combo -->
                                <div class="w-full mb-4">
                                    <div class="grid grid-cols-2 items-center">
                                        <div class="mb-px font-medium leading-tight">Add product
                                            <!-- <span class="mb-px font-medium leading-tight">Add product</span> -->
                                        </div>
                                        <!-- Filter by category -->
                                        <div class="justify-self-end">
                                            <!-- <mat-form-field class="fuse-mat-dense fuse-mat-rounded fuse-mat-no-subscript w-30 sm:w-30">
                                                <mat-select
                                                    [formControl]="localCategoryFilterControl"
                                                    [value]="localFilterByCatId"
                                                    placeholder="Category"
                                                    #categorySelector="matSelect"
                                                >
                                                    <mat-select-trigger>
                                                        <span class="flex items-center">
                                                            <span>{{ categorySelector.triggerValue }}</span>
                                                        </span>
                                                    </mat-select-trigger>
                                                    <mat-option [value]="''">All</mat-option>
                                                    <ng-container *ngFor="let category of productCategories$; trackBy: trackByFn">
                                                        <mat-option [value]="category.id">{{category.name}}</mat-option>
                                                    </ng-container>
                                                </mat-select>
                                            </mat-form-field> -->

                                            <!-- Category filter -->
                                            <mat-form-field class="fuse-mat-dense fuse-mat-rounded fuse-mat-no-subscript w-30 sm:w-30">
                                                <mat-select
                                                    class="w-full"
                                                    placeholder="Category"
                                                    (selectionChange)="onSelectCategoryList($event)">
                                                    <div>
                                                        <mat-option [value]="">All Categories</mat-option>
                                                        <mat-option *ngFor="let listing of productCategories$;" [value]="listing.id">
                                                            {{listing.name}}
                                                        </mat-option>
                                                    </div>
                                                </mat-select>
                                            </mat-form-field>
                                        </div>
                                    </div>
                                    <div class="mt-1 rounded-md border border-gray-300 dark:border-gray-500 shadow-sm overflow-hidden">
                                        <!-- Header -->
                                        <div class="flex items-center -my-px py-2 px-3">
                                            <div class="flex items-center flex-auto min-w-0">
                                                <mat-icon
                                                    class="icon-size-5"
                                                    [svgIcon]="'heroicons_solid:search'"></mat-icon>
                                                <input
                                                    class="min-w-0 ml-2 py-1 border-0"
                                                    type="text"
                                                    placeholder="Search product name"
                                                    (input)="filterProducts($event)"
                                                    (keydown)="filterProductsInputKeyDown($event)"
                                                    [maxLength]="50"
                                                    #newProductInput>
                                            </div>
                                        </div>
                                        <!-- Add product to option -->
                                        <div class="add-product-list pt-2 leading-none overflow-y-auto border-t border-gray-300 dark:border-gray-500">
                                            <!-- Products -->
                                            <ng-container *ngFor="let product of filteredProductsOptions; let i = index; trackBy: trackByFn;">
                                                <mat-checkbox
                                                    class="flex items-center h-10 min-h-10 px-4"
                                                    [color]="'primary'"
                                                    (change)="insertProductsInOption(product.id, $event)"
                                                    [checked]="onChangeSelectProductValue.includes(product.id)"
                                                    [ngModelOptions]="{standalone: true}"
                                                    [disabled]="product.isPackage"
                                                    >
                                                    <!-- [(ngModel)]="optionChecked[i]" -->
                                                    {{product.name}}
                                                </mat-checkbox>
                                            </ng-container>
                                        </div>
                                        <div class="border-t border-gray-300">
                                            <mat-paginator
                                                [ngClass]="{'pointer-events-none': isLoading}"
                                                [length]="productPaginationForCombo.length"
                                                [pageIndex]="productPaginationForCombo.page"
                                                [pageSize]="productPaginationForCombo.size"
                                                [pageSizeOptions]="[5, 10, 25, 100]"
                                                [showFirstLastButtons]="false"
                                                [hidePageSize]="true"
                                                #productPaginationCombo>
                                            </mat-paginator>
                                        </div>
                                    </div>
                                </div>

                                <!-- Item allowed of the option-->
                                <div class="w-full">
                                    <div class="grid grid-cols-2 items-center">

                                        <mat-form-field>
                                            <mat-label>Total allowed</mat-label>
                                            <input
                                                matInput
                                                type="number"
                                                [disabled]="addProductForm.get('comboSection').get('categoryId').value.length == 0"
                                                (change)="validateProductsOptionTotalAllowed($event.target.value)"
                                                [value]="(selectedProductsOption) ? selectedProductsOption.totalAllow : ''"
                                                #optionTotalAllow
                                                >
                                        </mat-form-field>
                                        <!-- Buttons -->
                                        <div>
                                            <div class="w-full flex pl-2 pt-2">
                                                <!-- <input
                                                    *ngIf="selectedProductsOption"
                                                    class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                    type="button"
                                                >
                                                <label
                                                    *ngIf="selectedProductsOption"
                                                    class="flex items-center justify-center w-9 h-9 rounded-full cursor-pointer bg-gray-300 hover:bg-gray-400 mr-3"
                                                    (click)="resetSelectedProductsOption()"
                                                    matTooltip="Cancel"
                                                    matRipple>
                                                    <mat-icon
                                                        class="text-white icon-size-5"
                                                        [svgIcon]="'heroicons_outline:x'"></mat-icon>
                                                </label>

                                                <input
                                                    class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                    type="button"
                                                >
                                                <label
                                                    class="flex items-center justify-center w-9 h-9 rounded-full cursor-pointer bg-blue-600 hover:bg-blue-400 mr-6"
                                                    (click)="updateSelectedProductsOption((selectedProductsOption) ? selectedProductsOption.id : '')"
                                                    (click)="optionTotalAllow.value=0"
                                                    (click)="clearOptName === true ? optionName.value='' : ''" 
                                                    [matTooltip]="selectedProductsOption ? 'Update' : 'Create'"
                                                    matRipple>
                                                    <mat-icon
                                                        *ngIf="selectedProductsOption"
                                                        class="text-white icon-size-5"
                                                        [svgIcon]="'heroicons_outline:check'"></mat-icon>
                                                    <mat-icon
                                                        *ngIf="!selectedProductsOption"
                                                        class="text-white icon-size-5"
                                                        [svgIcon]="'heroicons_outline:plus'"></mat-icon>
                                                </label> -->

                                                <button
                                                    type="button"
                                                    class="flex items-center justify-center w-9 h-9 rounded-full cursor-pointer bg-gray-300 hover:bg-gray-400 mr-3"
                                                    *ngIf="selectedProductsOption"
                                                    (click)="resetSelectedProductsOption()">
                                                    
                                                    <mat-icon
                                                        class="text-white icon-size-5"
                                                        [svgIcon]="'heroicons_outline:x'"></mat-icon>
                                                </button>
                                                <button
                                                    type="button"
                                                    class="flex items-center justify-center w-9 h-9 rounded-full cursor-pointer bg-blue-600 hover:bg-blue-400 mr-0"
                                                    (click)="updateSelectedProductsOption((selectedProductsOption) ? selectedProductsOption.id : '')"
                                                    (click)="optionTotalAllow.value=0"
                                                    (click)="clearOptName === true ? optionName.value='' : ''" 
                                                    [disabled]="addProductForm.get('comboSection').get('categoryId').value.length < totalAllowed"
                                                    [ngClass]="(addProductForm.get('comboSection').get('categoryId').value.length < totalAllowed) ? 'bg-blue-500 opacity-50 cursor-not-allowed' : ''"
                                                    >
                                                    <mat-icon
                                                        *ngIf="selectedProductsOption"
                                                        class="text-white icon-size-5"
                                                        [svgIcon]="'heroicons_outline:check'"></mat-icon>
                                                    <mat-icon
                                                        *ngIf="!selectedProductsOption"
                                                        class="text-white icon-size-5"
                                                        [svgIcon]="'heroicons_outline:plus'"></mat-icon>
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                </div>

                                <!-- Buttons -->
                                <!-- <div class="w-full flex flex-auto">
                                    <div class="w-full flex justify-end">
                                        <button
                                            mat-flat-button
                                            class="mr-3 bg-gray-300 hover:bg-gray-400"
                                            *ngIf="selectedProductsOption"
                                            (click)="resetSelectedProductsOption()">
                                            Cancel
                                        </button>
                                        <button
                                            mat-flat-button
                                            [color]="'primary'"
                                            (click)="updateSelectedProductsOption((selectedProductsOption) ? selectedProductsOption.id : '')"
                                            (click)="optionName.value='';optionTotalAllow.value=0">
                                            {{(selectedProductsOption) ? 'Update' : 'Create'}}
                                        </button>
                                    </div>
                                </div> -->
                            </div>
                            <!-- Combo Details Table -->
                            <div class="flex flex-col w-full sm:w-3/4 sm:pl-8 py-4 sm:py-0">
                                <div class="font-medium tracking-tight mb-1 truncate">Option Details</div>
                                <div class="flex flex-auto overflow-x-auto">
                                    <div class="flex flex-col flex-auto sm:mb-18">
                                        <ng-container>
                                            <ng-container>
                                                <div class="grid">
                                                    <!-- Header -->
                                                    <div
                                                        class="option-grid z-9 sticky top-0 grid gap-4 py-4 px-6 md:px-8 shadow text-md font-semibold text-secondary bg-gray-50 dark:bg-black dark:bg-opacity-5"
                                                        matSort
                                                        matSortDisableClear>
                                                        <div [mat-sort-header]="'optionName'">Option Name</div>
                                                        <div [mat-sort-header]="'optionTotalAllowed'">Total allowed</div>
                                                        <div [mat-sort-header]="'optionProducts'">Product in option</div>
                                                        <div [mat-sort-header]="'optionAction'">Action</div>
                                                    </div>
                                                    <!-- Rows -->
                                                    <div class="combo-details-grid overflow-y-auto">
                                                        <div *ngFor="let combos of productsCombos$; trackBy: trackByFn">
                                                            <div class="option-grid grid items-center gap-4 py-3 px-6 md:px-8 border-b">                                       
                                                                <!-- Option Name -->
                                                                <div class="truncate">
                                                                    {{combos.title}}
                                                                </div>
                            
                                                                <!-- Total Allowed -->
                                                                <div class="truncate text-center">
                                                                    {{combos.totalAllow}}
                                                                </div>

                                                                <!-- Product in option -->
                                                                <div class="truncate">
                                                                    <ng-container *ngIf="combos.productPackageOptionDetail.length">
                                                                        <ng-container *ngFor="let package of combos.productPackageOptionDetail; trackBy: trackByFn">
                                                                            <div *ngIf="package.product" class="flex items-center justify-center px-4 my-1.5 rounded-full leading-9 text-gray-500 bg-gray-100 dark:text-gray-300 dark:bg-gray-700">
                                                                                <span class="truncate text-md font-medium whitespace-nowrap">{{package.product.name}}</span>
                                                                            </div>
                                                                        </ng-container>
                                                                    </ng-container>
                                                                </div>

                                                                <!-- Action -->
                                                                <div class="flex flex-wrap">
                                                                    <input
                                                                        [id]="'select-option-btn' + combos.id"
                                                                        class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                                        type="button"
                                                                    >
                                                                    <label
                                                                        class="flex items-center justify-center w-9 h-9 rounded-full cursor-pointer bg-blue-600 hover:bg-blue-400 mr-3"
                                                                        [for]="'select-option-btn' + combos.id"
                                                                        (click)="selectProductOption(combos.id)"
                                                                        matRipple>
                                                                        <mat-icon
                                                                            class="text-white icon-size-5"
                                                                            [svgIcon]="'heroicons_outline:pencil-alt'"></mat-icon>
                                                                    </label>
                                                                    <input
                                                                        [id]="'delete-option-btn' + combos.id"
                                                                        class="absolute h-0 w-0 opacity-0 invisible pointer-events-none"
                                                                        type="button"
                                                                        (click)="deleteProductOption(combos.id)"
                                                                        >
                                                                    <label
                                                                        class="flex items-center justify-center w-9 h-9 rounded-full cursor-pointer bg-warn hover:bg-warn-700"
                                                                        [for]="'delete-option-btn' + combos.id"
                                                                        matRipple>
                                                                        <mat-icon
                                                                            class="text-white icon-size-5"
                                                                            [svgIcon]="'heroicons_outline:trash'"></mat-icon>
                                                                    </label>
                                                                </div>
                            
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </ng-container>
                                        </ng-container>

                                        <ng-template #noVariants>
                                            <div class="p-8 sm:p-16 border-t text-2xl font-semibold tracking-tight text-center">There are no Variants! Add them now.</div>
                                        </ng-template>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Back, Next button -->
                    <div class="flex justify-end mt-3">
                        <!-- Flash message -->
                        <div
                            class="flex items-center mr-4"
                            *ngIf="flashMessage">
                            <ng-container *ngIf="flashMessage === 'success'">
                                <mat-icon
                                    class="text-green-500"
                                    [svgIcon]="'heroicons_outline:check'"></mat-icon>
                                <span class="ml-2">Product created</span>
                            </ng-container>
                            <ng-container *ngIf="flashMessage === 'error'">
                                <mat-icon
                                    class="text-red-500"
                                    [svgIcon]="'heroicons_outline:x'"></mat-icon>
                                <span class="ml-2">An error occurred, try again!</span>
                            </ng-container>
                        </div>
                        <!-- <button
                            class="px-8 mr-2"
                            mat-flat-button
                            [color]="'accent'"
                            type="button"
                            (click)="testMethod()">
                            Test
                        </button> -->
                        <!-- Back button  -->
                        <button
                            class="sm:px-8 mr-2 sm:w-24"
                            mat-flat-button
                            [color]="'accent'"
                            type="button"
                            matStepperPrevious>
                            <mat-icon
                                    *ngIf="!currentScreenSize.includes('sm')"
                                    class="text-white icon-size-5"
                                    [svgIcon]="'heroicons_outline:chevron-left'">
                            </mat-icon>
                            <span class="hidden sm:block justify-center">
                                Back
                            </span>
                        </button>
                        <!-- Create button -->
                        <button
                            class="sm:px-8 sm:w-24"
                            mat-flat-button
                            [ngClass]="isLoading ? 'cursor-wait' : 'cursor-pointer'"
                            [disabled]="isLoading"
                            [color]="'primary'"
                            type="button"
                            (click)="postVariantMethod()"
                            matStepperNext>
                            <mat-icon
                                    *ngIf="!currentScreenSize.includes('sm')"
                                    class="text-white icon-size-5"
                                    [svgIcon]="'heroicons_outline:check'">
                            </mat-icon>
                            <span class="hidden sm:block justify-center">
                                Create
                            </span>
                        </button>
                    </div>
                </mat-step>

            </mat-horizontal-stepper>
        </form>
    </div>
</div>